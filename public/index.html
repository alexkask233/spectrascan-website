<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üõ°Ô∏è SpectraScan - Unmask Your Digital Ghost</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <style>
    /* --- CSS Variables --- */
    :root { /* Dark Theme (Default) */
      --bg-color: #121217; --card-color: #1e1e24; --border-color: #33333a; --text-primary: #f0f0f0; --text-secondary: #a9a9b3; --accent-green: #00ff88; --accent-red: #ff4757; --accent-blue: #00aaff; --success-bg: rgba(0, 255, 136, 0.1); --danger-bg: rgba(255, 71, 87, 0.1); --bg-glow-color: rgba(0, 255, 138, 0.05); --bg-grid-color: #2a2a30;
    }
    body.light-mode { /* Light Theme */
      --bg-color: #f4f4f8; --card-color: #ffffff; --border-color: #e0e0e6; --text-primary: #121217; --text-secondary: #66666e; --success-bg: rgba(0, 200, 110, 0.1); --danger-bg: rgba(255, 71, 87, 0.1); --bg-glow-color: rgba(0, 170, 255, 0.04); --bg-grid-color: #dce0e6;
    }

    /* --- Global & Background Styles --- */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background-color: var(--bg-color); color: var(--text-primary); font-family: 'Inter', sans-serif; line-height: 1.6; transition: background-color 0.3s ease; background-image: radial-gradient(circle at center, var(--bg-glow-color) 0%, transparent 40%), repeating-radial-gradient(circle at center, var(--bg-grid-color) 0, var(--bg-grid-color) 1px, transparent 1px, transparent 50px); background-size: 100% 100%, 50px 50px; }
    .page-wrapper { display: flex; flex-direction: column; min-height: 100vh; }
    main { flex-grow: 1; display: flex; justify-content: center; align-items: center; padding: 40px 20px; }
    .page { display: none; width: 100%; max-width: 700px; }
    .page.active { display: block; animation: page-transition-in 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
    @keyframes page-transition-in { from { opacity: 0; transform: translateY(20px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

    /* --- Header / Navigation --- */
    header { background-color: rgba(30, 30, 36, 0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); padding: 0 40px; display: flex; justify-content: space-between; align-items: center; height: 70px; position: sticky; top: 0; z-index: 100; transition: background-color 0.3s ease, border-color 0.3s ease; }
    body.light-mode header { background-color: rgba(255, 255, 255, 0.8); }
    .logo-link { text-decoration: none; }
    .logo { font-size: 20px; font-weight: 700; display: flex; align-items: center; gap: 10px; color: var(--text-primary); }
    .logo .fa-shield-halved { color: var(--accent-green); }
    nav { display: flex; align-items: center; gap: 30px; }
    nav .nav-link { color: var(--text-secondary); text-decoration: none; font-weight: 500; transition: color 0.2s ease; }
    nav .nav-link:hover, nav .nav-link.active { color: var(--text-primary); }
    #theme-toggle-btn { background: none; border: none; color: var(--text-secondary); font-size: 20px; cursor: pointer; transition: color 0.2s ease, transform 0.2s ease; }
    #theme-toggle-btn:hover { color: var(--text-primary); transform: scale(1.1); }
    #hamburger-btn, #close-nav-btn { display: none; background: none; border: none; font-size: 24px; color: var(--text-primary); cursor: pointer; }
    #close-nav-btn { position: absolute; top: 20px; right: 20px; }
    
    footer { text-align: center; padding: 20px; color: var(--text-secondary); font-size: 14px; background-color: var(--card-color); border-top: 1px solid var(--border-color); margin-top: auto; transition: background-color 0.3s ease, border-color 0.3s ease; }
    
    .container { background-color: var(--card-color); padding: 30px 40px; border-radius: 16px; border: 1px solid var(--border-color); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); transition: background-color 0.3s ease, border-color 0.3s ease; }
    h1 { font-size: 28px; font-weight: 700; margin-bottom: 10px; text-align: center; color: var(--text-primary); }
    .tagline { color: var(--text-secondary); margin-bottom: 30px; font-size: 16px; text-align: center; }
    button { cursor: pointer; transition: all 0.2s ease; font-family: 'Inter', sans-serif; }
    button#run-btn, button#reset-btn { width: 100%; border: none; border-radius: 10px; font-weight: 700; font-size: 16px; }
    button#run-btn { padding: 15px; background: var(--accent-green); color: #000; }
    button#run-btn:hover { background-color: #00e67a; transform: translateY(-2px); }
    button#reset-btn { padding: 12px; background: var(--border-color); color: var(--text-secondary); margin-top: 20px; }
    button#reset-btn:hover { background: #44444e; color: var(--text-primary); }
    body.light-mode button#reset-btn:hover { background: #d0d0d6; }
    #results-container { margin-top: 30px; text-align: left; }
    .loader-wrapper { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 0; animation: page-transition-in 0.5s; }
    .scanner-circle { width: 60px; height: 60px; border: 4px solid var(--border-color); border-top-color: var(--accent-green); border-radius: 50%; animation: spin 1s linear infinite, pulse 2s ease-in-out infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(0, 255, 138, 0.4); } 50% { box-shadow: 0 0 0 10px rgba(0, 255, 138, 0); } }
    .verdict-box { padding: 15px; font-size: 18px; font-weight: 500; border-radius: 10px; border: 1px solid; display: flex; align-items: center; gap: 12px; margin-bottom: 20px; }
    .verdict-box.safe { background-color: var(--success-bg); border-color: var(--accent-green); color: var(--accent-green); }
    .verdict-box.danger { background-color: var(--danger-bg); border-color: var(--accent-red); color: var(--accent-red); }
    .risk-score { font-size: 16px; color: var(--text-secondary); text-align: center; margin-bottom: 25px; }
    .risk-score strong { color: var(--text-primary); font-weight: 700; }
    .details-grid { display: grid; grid-template-columns: auto 1fr; gap: 10px 20px; padding-top: 20px; border-top: 1px solid var(--border-color); }
    .details-grid .label, .details-grid .value { font-weight: 500; word-break: break-all; }
    .details-grid .label { color: var(--text-secondary); }
    .details-grid .value { color: var(--text-primary); font-size: 14px; }
    .details-grid .value.danger { color: var(--accent-red); font-weight: 700; }
    .details-grid .value.safe { color: var(--accent-green); }
    .static-page h2 { font-size: 24px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color); color: var(--text-primary); }
    .static-page p { color: var(--text-secondary); margin-bottom: 20px; }
    .static-page h3 { color: var(--accent-blue); margin-top: 30px; margin-bottom: 10px; }
    
    @media (max-width: 768px) {
        header { padding: 0 20px; }
        nav .nav-link, nav #theme-toggle-btn { display: none; }
        #hamburger-btn { display: block; }
        nav { position: fixed; top: 0; right: -100%; width: 100%; height: 100vh; background: rgba(18, 18, 23, 0.95); backdrop-filter: blur(10px); flex-direction: column; justify-content: center; align-items: center; gap: 40px; transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        body.light-mode nav { background: rgba(244, 244, 248, 0.95); }
        nav.is-open { right: 0; }
        nav.is-open .nav-link, nav.is-open #theme-toggle-btn, nav.is-open #close-nav-btn { display: block; font-size: 24px; }
        .container { padding: 20px; }
        h1 { font-size: 24px; }
        .details-grid { grid-template-columns: 1fr; text-align: center; gap: 4px; }
        .details-grid .value { margin-bottom: 16px; }
    }
  </style>
</head>
<body>

<div class="page-wrapper">
  <!-- ====== HEADER & NAVIGATION (No changes from your code) ====== -->
  <header>
    <a href="/" class="logo-link">
      <div class="logo">
        <i class="fa-solid fa-shield-halved"></i>
        <span>SpectraScan</span>
      </div>
    </a>
    <button id="hamburger-btn" aria-label="Open menu"><i class="fa-solid fa-bars"></i></button>
    <nav id="main-nav">
        <button id="close-nav-btn" aria-label="Close menu"><i class="fa-solid fa-times"></i></button>
        <a href="/" class="nav-link">Catcher</a>
        <a href="/faq" class="nav-link">FAQ</a>
        <a href="/privacy" class="nav-link">Privacy</a>
        <a href="/contact" class="nav-link">Contact</a>
        <button id="theme-toggle-btn" title="Toggle theme"><i class="fa-solid fa-moon"></i></button>
    </nav>
  </header>

  <!-- ====== MAIN CONTENT & PAGES (No changes from your code) ====== -->
  <main>
    <div id="page-catcher" class="page"><div class="container" id="catcher-container"><h1>Unmask Your Digital Ghost</h1><p class="tagline">Is your browser hiding in the shadows? Let's find out.</p><button id="run-btn" onclick="runDetection()">Run Detection</button><div id="results-container"></div></div></div>
    <div id="page-faq" class="page"><div class="container static-page"><h2>Frequently Asked Questions</h2><h3>What is this tool?</h3><p>SpectraScan analyzes your browser's fingerprint for signs of manipulation. Websites use these fingerprints to track you. Our tool checks for common spoofing techniques (Canvas, WebGL, Audio) and flags connections from known VPNs or proxies.</p><h3>Why is a high risk score bad?</h3><p>A high score suggests your fingerprint is inconsistent, a common trait of antidetect browsers. While used for privacy, these browsers are often flagged as fraudulent by platforms like banks and e-commerce sites, risking account suspension.</p><h3>Is a score of 1 or 2 bad?</h3><p>No. A score below 3 is generally safe. Normal browsers can have minor inconsistencies. We only flag a browser as "likely antidetect" when multiple significant red flags are found.</p><h3>Is this 100% accurate?</h3><p>No tool is infallible in the cat-and-mouse game of browser security. This tool provides a strong, indicative analysis, not absolute proof.</p></div></div>
    <div id="page-privacy" class="page"><div class="container static-page"><h2>Privacy Policy</h2><p>Your privacy is paramount. Our policy is simple: we don't store your data.</p><h3>IP Address Handling</h3><p>Your IP address is used *only* to perform the check with third-party databases during your session. It is never logged or stored on our servers.</p><h3>Browser Fingerprint</h3><p>All fingerprinting happens in your browser. Raw data (WebGL, Canvas, etc.) is never sent to us. Your device performs the analysis locally.</p><h3>Cookies & Tracking</h3><p>This website does not use cookies for tracking. Period.</p></div></div>
    <div id="page-contact" class="page"><div class="container static-page"><h2>Get In Touch</h2><p>Have a question, feedback, or a partnership inquiry? We'd love to hear from you. Fill out the form below and our team will get back to you as soon as possible.</p><form class="contact-form" onsubmit="event.preventDefault(); alert('Thank you for your message! Our team will review it shortly.'); this.reset();"><div class="form-group"><input type="text" name="name" placeholder="Your Name" required></div><div class="form-group"><input type="email" name="email" placeholder="Your Email Address" required></div><div class="form-group"><input type="text" name="subject" placeholder="Subject" required></div><div class="form-group"><textarea name="message" placeholder="Your Message" required></textarea></div><button type="submit" class="form-submit-btn">Send Message</button></form></div></div>
  </main>
  
  <!-- ====== FOOTER (No changes from your code) ====== -->
  <footer>¬© 2025 SpectraScan. All rights reserved. Your Shield in the Digital Shadows.</footer>
</div>

<script>
  /* --- RESPONSIVE NAVIGATION & THEME (No changes from your code) --- */
  const hamburgerBtn = document.getElementById('hamburger-btn'); const closeNavBtn = document.getElementById('close-nav-btn'); const mainNav = document.getElementById('main-nav');
  hamburgerBtn.addEventListener('click', () => mainNav.classList.add('is-open'));
  closeNavBtn.addEventListener('click', () => mainNav.classList.remove('is-open'));
  const themeToggleBtn = document.getElementById('theme-toggle-btn'); const body = document.body; const themeIcon = themeToggleBtn.querySelector('i');
  function applySavedTheme() { const savedTheme = localStorage.getItem('theme'); if (savedTheme === 'light') { body.classList.add('light-mode'); themeIcon.classList.remove('fa-moon'); themeIcon.classList.add('fa-sun'); } else { body.classList.remove('light-mode'); themeIcon.classList.remove('fa-sun'); themeIcon.classList.add('fa-moon'); } }
  themeToggleBtn.addEventListener('click', () => { body.classList.toggle('light-mode'); if (body.classList.contains('light-mode')) { localStorage.setItem('theme', 'light'); themeIcon.classList.remove('fa-moon'); themeIcon.classList.add('fa-sun'); } else { localStorage.setItem('theme', 'dark'); themeIcon.classList.remove('fa-sun'); themeIcon.classList.add('fa-moon'); } });
  const pageContent = { '/': 'page-catcher', '/faq': 'page-faq', '/privacy': 'page-privacy', '/contact': 'page-contact' };
  function showPageContent(pageId) { document.querySelectorAll('.page').forEach(p => p.classList.remove('active')); document.getElementById(pageId).classList.add('active'); document.querySelectorAll('.nav-link').forEach(l => { l.classList.remove('active'); const path = (new URL(l.href)).pathname; if (path === window.location.pathname || (window.location.pathname === '/' && path === '/')) l.classList.add('active'); });}
  const router = () => { const path = window.location.pathname; const pageId = pageContent[path] || 'page-catcher'; showPageContent(pageId); };
  document.addEventListener('click', (e) => { const a = e.target.closest('a'); if (a && (a.matches('.nav-link') || a.matches('.logo-link'))) { e.preventDefault(); history.pushState(null, '', a.href); mainNav.classList.remove('is-open'); router(); }});
  window.addEventListener('popstate', router);
  document.addEventListener('DOMContentLoaded', () => { applySavedTheme(); router(); });

  /* ============================================= */
  /* ---           CATCHER SCRIPT              --- */
  /* ============================================= */

  const knownSpoofedAudio = [18028.99390631693, 48000.276471651436];
  const knownRealGPUs = ["NVIDIA GeForce RTX", "NVIDIA GeForce GTX", "AMD Radeon RX", "Apple M1", "Apple M2", "Apple M3"];

  function resetCatcher() {
    document.getElementById('results-container').innerHTML = '';
    document.getElementById('run-btn').style.display = 'block';
  }

  async function runDetection() {
    const runBtn = document.getElementById('run-btn');
    const resultsEl = document.getElementById('results-container');
    runBtn.style.display = 'none';
    resultsEl.innerHTML = `<div class="loader-wrapper"><div class="scanner-circle"></div><p class="scanner-text">ANALYZING SIGNATURE...</p></div>`;

    const detectionPromise = (async () => {
        let riskScore = 0;
        let flagsHTML = '';

        // --- IP Check (API Call) ---
        let ipRisk = 0;
        let ipData = null;
        let ipError = false;
        try {
            const resp = await fetch('/api/ip-check');
            ipData = await resp.json();
            if (ipData.error) {
              ipError = true;
            } else if (ipData.isProxy) {
              ipRisk = 2; // +2 points for VPN/Proxy
            }
        } catch (e) {
            ipError = true;
        }
        riskScore += ipRisk;

        // --- Browser-side Checks ---
        const gl = getWebGLInfo();
        const canvasCheck = checkCanvasRandomization();

        // 1. Canvas Noise Spoofing (+2 Risk)
        if (canvasCheck.isSpoofed) {
            riskScore += 2;
            flagsHTML += `<div class="label">Canvas Fingerprint:</div><div class="value danger">RANDOMIZED</div>`;
            flagsHTML += `<div class="label">Signature 1:</div><div class="value">${canvasCheck.signature1}</div>`;
            flagsHTML += `<div class="label">Signature 2:</div><div class="value">${canvasCheck.signature2}</div>`;
        } else {
            flagsHTML += `<div class="label">Canvas Fingerprint:</div><div class="value safe">CONSISTENT</div>`;
            flagsHTML += `<div class="label">Signature:</div><div class="value">${canvasCheck.signature1}</div>`;
        }

        // 2. WebGL ANGLE Spoofing (+1 Risk)
        const isWinSpoofed = navigator.platform === "Win32" && gl.vendor.includes("Google Inc.") && gl.renderer.includes("ANGLE") && !knownRealGPUs.some(gpu => gl.renderer.includes(gpu));
        if (isWinSpoofed) {
            riskScore += 1;
            flagsHTML += `<div class="label">WebGL Renderer:</div><div class="value danger">Spoofed (ANGLE)</div>`;
        } else {
            flagsHTML += `<div class="label">WebGL Renderer:</div><div class="value safe">Normal</div>`;
        }

        // 3. Secondary Checks (Displayed but no score impact)
        const language = navigator.language;
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
        const audioFingerprint = await getAudioFingerprint();
        if (!timezone.toLowerCase().includes(language.slice(0, 2))) {
            flagsHTML += `<div class="label">Timezone/Language:</div><div class="value danger">Mismatch</div>`;
        }
        if (knownSpoofedAudio.includes(audioFingerprint)) {
            flagsHTML += `<div class="label">Audio Context:</div><div class="value danger">Known Spoofed Value</div>`;
        }

        // --- Final Verdict & Rendering ---
        const isAntidetect = riskScore >= 3;
        let resultsHTML = '';
        resultsHTML += `<div class="verdict-box ${isAntidetect ? 'danger' : 'safe'}"><i class="fa-solid ${isAntidetect ? 'fa-triangle-exclamation' : 'fa-circle-check'}"></i><span>${isAntidetect ? "This is likely an Antidetect Browser!" : "This appears to be a Normal Browser."}</span></div>`;
        resultsHTML += `<div class="risk-score">Total Risk Score: <strong>${riskScore}/5</strong></div>`;

        // Display IP info
        if (ipError) {
          resultsHTML += `<div class="details-grid" style="padding-bottom: 20px;"><div class="label">IP Status:</div><div class="value danger">Error fetching IP details</div></div>`;
        } else {
          if (ipData.isProxy) { 
            resultsHTML += `<div class="verdict-box danger" style="margin-bottom: 20px;"><i class="fa-solid fa-tower-broadcast"></i><span>VPN / Proxy Detected!</span></div>`;
          }
          resultsHTML += `<div class="details-grid" style="padding-bottom: 20px;"><div class="label">IP Address:</div><div class="value">${ipData.ip}</div><div class="label">IP Status:</div><div class="value ${ipData.isProxy ? 'danger' : 'safe'}">${ipData.status}</div></div>`;
        }

        resultsHTML += `<div class="details-grid">${flagsHTML}</div>`;
        resultsHTML += `<button id="reset-btn" onclick="resetCatcher()">Run Another Test</button>`;
        return resultsHTML;
    })();

    const minDelay = new Promise(resolve => setTimeout(resolve, 1500));
    const [finalHTML] = await Promise.all([detectionPromise, minDelay]);
    resultsEl.innerHTML = finalHTML;
  }

  /* --- FINGERPRINTING & HASHING HELPERS --- */

  // NEW: MD5 Hashing Function
  function md5(str) {
    function rotateLeft(lValue, iShiftBits) { return (lValue << iShiftBits) | (lValue >>> (32 - iShiftBits));}
    function addUnsigned(lX, lY) {
        let lX4, lY4, lX8, lY8, lResult;
        lX8 = (lX & 0x80000000); lY8 = (lY & 0x80000000);
        lX4 = (lX & 0x40000000); lY4 = (lY & 0x40000000);
        lResult = (lX & 0x3FFFFFFF) + (lY & 0x3FFFFFFF);
        if (lX4 & lY4) return (lResult ^ 0x80000000 ^ lX8 ^ lY8);
        if (lX4 | lY4) { if (lResult & 0x40000000) return (lResult ^ 0xC0000000 ^ lX8 ^ lY8); else return (lResult ^ 0x40000000 ^ lX8 ^ lY8); } 
        else return (lResult ^ lX8 ^ lY8);
    }
    function F(x, y, z) { return (x & y) | ((~x) & z); }
    function G(x, y, z) { return (x & z) | (y & (~z)); }
    function H(x, y, z) { return (x ^ y ^ z); }
    function I(x, y, z) { return (y ^ (x | (~z))); }
    function FF(a, b, c, d, x, s, ac) { a = addUnsigned(a, addUnsigned(addUnsigned(F(b, c, d), x), ac)); return addUnsigned(rotateLeft(a, s), b); }
    function GG(a, b, c, d, x, s, ac) { a = addUnsigned(a, addUnsigned(addUnsigned(G(b, c, d), x), ac)); return addUnsigned(rotateLeft(a, s), b); }
    function HH(a, b, c, d, x, s, ac) { a = addUnsigned(a, addUnsigned(addUnsigned(H(b, c, d), x), ac)); return addUnsigned(rotateLeft(a, s), b); }
    function II(a, b, c, d, x, s, ac) { a = addUnsigned(a, addUnsigned(addUnsigned(I(b, c, d), x), ac)); return addUnsigned(rotateLeft(a, s), b); }
    function convertToWordArray(str) {
        let lWordCount, temp, i;
        const lMessageLength = str.length;
        lWordCount = (lMessageLength + 8 - ((lMessageLength + 8) % 64)) / 64 + 1;
        const x = Array(lWordCount * 16).fill(0);
        for (i = 0; i < lMessageLength; i++) x[i >> 2] |= str.charCodeAt(i) << ((i % 4) * 8);
        i = lMessageLength; x[i >> 2] |= 0x80 << ((i % 4) * 8);
        x[lWordCount * 16 - 2] = lMessageLength << 3;
        return x;
    }
    let k, AA, BB, CC, DD, S11=7, S12=12, S13=17, S14=22, S21=5, S22=9, S23=14, S24=20, S31=4, S32=11, S33=16, S34=23, S41=6, S42=10, S43=15, S44=21;
    const x = convertToWordArray(str);
    let a = 0x67452301, b = 0xEFCDAB89, c = 0x98BADCFE, d = 0x10325476;
    for (k = 0; k < x.length; k += 16) {
        AA = a; BB = b; CC = c; DD = d;
        a = FF(a, b, c, d, x[k + 0], S11, 0xD76AA478); d = FF(d, a, b, c, x[k + 1], S12, 0xE8C7B756); c = FF(c, d, a, b, x[k + 2], S13, 0x242070DB); b = FF(b, c, d, a, x[k + 3], S14, 0xC1BDCEEE);
        a = FF(a, b, c, d, x[k + 4], S11, 0xF57C0FAF); d = FF(d, a, b, c, x[k + 5], S12, 0x4787C62A); c = FF(c, d, a, b, x[k + 6], S13, 0xA8304613); b = FF(b, c, d, a, x[k + 7], S14, 0xFD469501);
        a = FF(a, b, c, d, x[k + 8], S11, 0x698098D8); d = FF(d, a, b, c, x[k + 9], S12, 0x8B44F7AF); c = FF(c, d, a, b, x[k + 10], S13, 0xFFFF5BB1); b = FF(b, c, d, a, x[k + 11], S14, 0x895CD7BE);
        a = FF(a, b, c, d, x[k + 12], S11, 0x6B901122); d = FF(d, a, b, c, x[k + 13], S12, 0xFD987193); c = FF(c, d, a, b, x[k + 14], S13, 0xA679438E); b = FF(b, c, d, a, x[k + 15], S14, 0x49B40821);
        a = GG(a, b, c, d, x[k + 1], S21, 0xF61E2562); d = GG(d, a, b, c, x[k + 6], S22, 0xC040B340); c = GG(c, d, a, b, x[k + 11], S23, 0x265E5A51); b = GG(b, c, d, a, x[k + 0], S24, 0xE9B6C7AA);
        a = GG(a, b, c, d, x[k + 5], S21, 0xD62F105D); d = GG(d, a, b, c, x[k + 10], S22, 0x02441453); c = GG(c, d, a, b, x[k + 15], S23, 0xD8A1E681); b = GG(b, c, d, a, x[k + 4], S24, 0xE7D3FBC8);
        a = GG(a, b, c, d, x[k + 9], S21, 0x21E1CDE6); d = GG(d, a, b, c, x[k + 14], S22, 0xC33707D6); c = GG(c, d, a, b, x[k + 3], S23, 0xF4D50D87); b = GG(b, c, d, a, x[k + 8], S24, 0x455A14ED);
        a = GG(a, b, c, d, x[k + 13], S21, 0xA9E3E905); d = GG(d, a, b, c, x[k + 2], S22, 0xFCEFA3F8); c = GG(c, d, a, b, x[k + 7], S23, 0x676F02D9); b = GG(b, c, d, a, x[k + 12], S24, 0x8D2A4C8A);
        a = HH(a, b, c, d, x[k + 5], S31, 0xFFFA3942); d = HH(d, a, b, c, x[k + 8], S32, 0x8771F681); c = HH(c, d, a, b, x[k + 11], S33, 0x6D9D6122); b = HH(b, c, d, a, x[k + 14], S34, 0xFDE5380C);
        a = HH(a, b, c, d, x[k + 1], S31, 0xA4BEEA44); d = HH(d, a, b, c, x[k + 4], S32, 0x4BDECFA9); c = HH(c, d, a, b, x[k + 7], S33, 0xF6BB4B60); b = HH(b, c, d, a, x[k + 10], S34, 0xBEBFBC70);
        a = HH(a, b, c, d, x[k + 13], S31, 0x289B7EC6); d = HH(d, a, b, c, x[k + 0], S32, 0xEAA127FA); c = HH(c, d, a, b, x[k + 3], S33, 0xD4EF3085); b = HH(b, c, d, a, x[k + 6], S34, 0x04881D05);
        a = HH(a, b, c, d, x[k + 9], S31, 0xD9D4D039); d = HH(d, a, b, c, x[k + 12], S32, 0xE6DB99E5); c = HH(c, d, a, b, x[k + 15], S33, 0x1FA27CF8); b = HH(b, c, d, a, x[k + 2], S34, 0xC4AC5665);
        a = II(a, b, c, d, x[k + 0], S41, 0xF4292244); d = II(d, a, b, c, x[k + 7], S42, 0x432AFF97); c = II(c, d, a, b, x[k + 14], S43, 0xAB9423A7); b = II(b, c, d, a, x[k + 5], S44, 0xFC93A039);
        a = II(a, b, c, d, x[k + 12], S41, 0x655B59C3); d = II(d, a, b, c, x[k + 3], S42, 0x8F0CCC92); c = II(c, d, a, b, x[k + 10], S43, 0xFFEFF47D); b = II(b, c, d, a, x[k + 1], S44, 0x85845DD1);
        a = II(a, b, c, d, x[k + 8], S41, 0x6FA87E4F); d = II(d, a, b, c, x[k + 15], S42, 0xFE2CE6E0); c = II(c, d, a, b, x[k + 6], S43, 0xA3014314); b = II(b, c, d, a, x[k + 13], S44, 0x4E0811A1);
        a = II(a, b, c, d, x[k + 4], S41, 0xF7537E82); d = II(d, a, b, c, x[k + 11], S42, 0xBD3AF235); c = II(c, d, a, b, x[k + 2], S43, 0x2AD7D2BB); b = II(b, c, d, a, x[k + 9], S44, 0xEB86D391);
        a = addUnsigned(a, AA); b = addUnsigned(b, BB); c = addUnsigned(c, CC); d = addUnsigned(d, DD);
    }
    const temp = "0123456789abcdef";
    let wordToHex = (lValue) => { let wordToHexValue = "", wordToHexValue_temp = "", lByte, lCount; for (lCount = 0; lCount <= 3; lCount++) { lByte = (lValue >>> (lCount * 8)) & 255; wordToHexValue_temp = "0" + lByte.toString(16); wordToHexValue = wordToHexValue + wordToHexValue_temp.substr(wordToHexValue_temp.length - 2, 2); } return wordToHexValue; };
    return wordToHex(a) + wordToHex(b) + wordToHex(c) + wordToHex(d);
  }

  // NEW: Generates a canvas signature using a more complex drawing
  function getCanvasSignature() {
    try {
        const canvas = document.createElement('canvas');
        canvas.width = 200;
        canvas.height = 60;
        const ctx = canvas.getContext('2d');

        // Draw various elements to create a detailed fingerprint
        ctx.fillStyle = "rgb(123, 45, 67)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#f60";
        ctx.fillRect(10, 10, 50, 20);
        ctx.font = "16px 'Arial'";
        ctx.fillStyle = "rgba(255, 102, 0, 0.7)";
        ctx.fillText("Browser Fingerprint üõ°Ô∏è", 5, 45);
        
        // Add a gradient
        const gradient = ctx.createLinearGradient(0, 0, 200, 0);
        gradient.addColorStop(0, "red");
        gradient.addColorStop(1, "white");
        ctx.fillStyle = gradient;
        ctx.fillRect(100, 10, 90, 40);

        // Hash the data URL
        return md5(canvas.toDataURL());
    } catch (e) {
        return "error";
    }
  }

  // NEW: Checks for canvas randomization
  function checkCanvasRandomization() {
      const signature1 = getCanvasSignature();
      const signature2 = getCanvasSignature();
      return {
          isSpoofed: signature1 !== signature2,
          signature1: signature1,
          signature2: signature2
      };
  }
  
  async function getAudioFingerprint(){try{const AudioContext=window.AudioContext||window.webkitAudioContext;if(!AudioContext)return null;const ctx=new AudioContext;const osc=ctx.createOscillator();const analyser=ctx.createAnalyser();const gain=ctx.createGain();const script=ctx.createScriptProcessor(4096,1,1);return new Promise(resolve=>{script.onaudioprocess=e=>{const output=e.outputBuffer.getChannelData(0);const hash=Math.abs(output.slice(4500,5000).reduce((a,b)=>a+b,0));resolve(parseFloat(hash.toFixed(12)));script.disconnect();osc.disconnect();gain.disconnect();analyser.disconnect();ctx.close()};osc.connect(analyser);analyser.connect(script);script.connect(gain);gain.connect(ctx.destination);osc.start(0)})}catch{return null}}
  function getWebGLInfo(){try{const canvas=document.createElement('canvas');const gl=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');const dbg=gl.getExtension('WEBGL_debug_renderer_info');return{vendor:gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL),renderer:gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL)}}catch{return{vendor:"unknown",renderer:"unknown"}}}
</script>

</body>
</html>