<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üõ°Ô∏è SpectraScan - Unmask Your Digital Ghost</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20384%20512'%3E%3Cpath%20fill='%23000000'%20d='M256%200C114.6%200%200%20114.6%200%20256s114.6%20256%20256%20256s256-114.6%20256-256S397.4%200%20256%200zM192%20160a32%2032%200%201%201-64%200%2032%2032%200%201%201%2064%200zm128%200a32%2032%200%201%201-64%200%2032%2032%200%201%201%2064%200zM160%20336H352c8.8%200%2016%207.2%2016%2016s-7.2%2016-16%2016H160c-8.8%200-16-7.2-16-16s7.2-16%2016-16z'/%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  
  <script src="https://cdn.jsdelivr.net/npm/@thumbmarkjs/thumbmarkjs/dist/thumbmark.umd.js"></script>

  <style>
    :root {
      --bg-color: #0d0d12;
      --card-color: rgba(30, 30, 36, 0.9);
      --border-color: #33333a;
      --text-primary: #f0f0f0;
      --text-secondary: #a9a9b3;
      --accent-green: #00ff88;
      --accent-red: #ff4757;
      --accent-blue: #00aaff;
      --success-bg: rgba(0, 255, 136, 0.1);
      --danger-bg: rgba(255, 71, 87, 0.1);
      --bg-grid-color: rgba(42, 42, 48, 0.7);
      --header-bg-color: rgba(18, 18, 23, 0.98);
      --nav-overlay-bg: rgba(18, 18, 23, 0.98);

      --scroll-anim-delay: 0s;
      --scroll-anim-duration: 0.8s;
      --scroll-anim-ease: cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    body.light-mode {
      --bg-color: #f4f4f8;
      --card-color: #ffffff;
      --border-color: #e0e0e6;
      --text-primary: #121217;
      --text-secondary: #66666e;
      --success-bg: rgba(0, 200, 110, 0.1);
      --danger-bg: rgba(255, 71, 87, 0.1);
      --bg-grid-color: rgba(220, 224, 230, 0.8);
      --header-bg-color: #ffffff;
      --nav-overlay-bg: rgba(255, 255, 255, 0.98);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    html { height: 100%; scroll-behavior: smooth; }
    body { 
      height: 100%; 
      background-color: var(--bg-color); 
      color: var(--text-primary); 
      font-family: 'Inter', sans-serif; 
      line-height: 1.6; 
      position: relative; 
      overflow-x: hidden;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -3;
        background-image: 
            linear-gradient(to right, var(--border-color) 1px, transparent 1px),
            linear-gradient(to bottom, var(--border-color) 1px, transparent 1px);
        background-size: 30px 30px;
        opacity: 0.05;
        pointer-events: none;
    }

    #matrix-bg { 
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%; 
      z-index: -2; 
      opacity: 0.02; /* Very subtle matrix remains */
      transition: opacity 0.5s ease-in-out; 
      mix-blend-mode: screen;
    }
    
    .page-wrapper { display: flex; flex-direction: column; min-height: 100vh; }
    main { flex-grow: 1; display: flex; justify-content: center; align-items: center; padding: 60px 20px; }

    #background-watermark {
        content: attr(data-text); position: fixed; top: 50%; left: 50%;
        transform: translate(-50%, -50%) rotate(-15deg);
        font-size: 15vw; font-family: 'Roboto Mono', monospace; font-weight: 700;
        opacity: 0; pointer-events: none; z-index: -1; transition: opacity 0.5s ease, color 0.5s ease, text-shadow 0.5s ease;
        text-shadow: none;
    }
    body.danger-mode #background-watermark {
        color: var(--accent-red); text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        opacity: 0.1; animation: watermark-flicker 2s infinite alternate;
    }
    body.safe-mode #background-watermark {
        color: var(--accent-blue); text-shadow: 0 0 10px rgba(0, 170, 255, 0.5);
        opacity: 0.05; animation: watermark-flicker 4s infinite alternate;
    }
    @keyframes watermark-flicker { 0%, 90% { opacity: 0.1; } 95% { opacity: 0.05; } 100% { opacity: 0.12; } }

    .page { display: none; width: 100%; max-width: 700px; }
    .page.active { 
      display: block; 
      animation: page-transition-in 0.5s var(--scroll-anim-ease) forwards; 
    }
    @keyframes page-transition-in { 
      from { opacity: 0; transform: translateY(20px) scale(0.98); } 
      to { opacity: 1; transform: translateY(0) scale(1); } 
    }

    header { 
      background-color: var(--header-bg-color);
      backdrop-filter: blur(10px); 
      -webkit-backdrop-filter: blur(10px); 
      border-bottom: 1px solid var(--border-color); 
      padding: 0 40px; 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      height: 70px; 
      position: sticky; 
      top: 0; 
      z-index: 100; 
      transition: background-color 0.3s ease, border-color 0.3s ease; 
      will-change: background-color, border-color; /* Hint for smoother transitions */
    }
    .logo-link { text-decoration: none; }
    .logo { 
      font-size: 20px; 
      font-weight: 700; 
      display: flex; 
      align-items: center; 
      gap: 10px; 
      color: var(--text-primary);
      transition: color 0.3s ease, transform 0.3s ease;
      will-change: color, transform;
    }
    .logo:hover {
      transform: scale(1.05);
      color: var(--accent-green);
    }
    .logo .fa-shield-halved { color: var(--accent-green); transition: transform 0.3s ease; }
    .logo:hover .fa-shield-halved {
      transform: rotate(10deg);
    }

    nav { display: flex; align-items: center; gap: 30px; }
    nav .nav-link { 
      color: var(--text-secondary); 
      text-decoration: none; 
      font-weight: 500; 
      transition: color 0.2s ease, text-shadow 0.2s ease; 
      position: relative;
      will-change: color, text-shadow, transform;
    }
    nav .nav-link::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 1px;
      bottom: -4px;
      left: 0;
      background-color: var(--accent-green);
      transform: scaleX(0);
      transform-origin: bottom right;
      transition: transform 0.25s ease-out;
    }
    nav .nav-link:hover::after {
      transform: scaleX(1);
      transform-origin: bottom left;
    }
    nav .nav-link:hover, nav .nav-link.active { color: var(--text-primary); text-shadow: 0 0 5px var(--accent-green);}
    #theme-toggle-btn { 
      background: none; border: none; color: var(--text-secondary); font-size: 20px; cursor: pointer; 
      transition: color 0.2s ease, transform 0.2s ease; 
      will-change: color, transform;
    }
    #theme-toggle-btn:hover { color: var(--text-primary); transform: rotate(15deg); }
    
    #hamburger-btn, #close-nav-btn { display: none; background: none; border: none; font-size: 24px; color: var(--text-primary); cursor: pointer; }
    #close-nav-btn { position: absolute; top: 20px; right: 20px; }
    
    footer { text-align: center; padding: 20px; color: var(--text-secondary); font-size: 14px; background-color: var(--card-color); border-top: 1px solid var(--border-color); transition: background-color 0.3s ease, border-color 0.3s ease; font-family: 'Roboto Mono', monospace; }
    footer .footer-icons { margin-top: 10px; display: flex; justify-content: center; gap: 20px; font-size: 18px; color: var(--accent-green); }
    footer .footer-icons i { transition: transform 0.3s ease; will-change: transform; }
    footer .footer-icons i:hover { transform: translateY(-3px) scale(1.1); }
    
    .container { 
      background-color: var(--card-color); padding: 30px 40px; border-radius: 16px; border: 1px solid var(--border-color); 
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); 
      transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease; 
      position: relative; overflow: hidden; 
      will-change: background-color, border-color, box-shadow, transform, opacity;
    }
    
    .classified-stamp {
        position: absolute; top: 25px; right: 25px;
        transform: rotate(10deg); color: var(--accent-red);
        border: 3px solid var(--accent-red); padding: 5px 10px;
        font-family: 'Roboto Mono', monospace; font-weight: 700;
        font-size: 18px; opacity: 0.7; user-select: none;
        transition: all 0.4s ease;
        will-change: transform, opacity;
    }
    .classified-stamp.safe { border-color: var(--accent-blue); color: var(--accent-blue); }
    .classified-stamp.danger { border-color: var(--accent-red); color: var(--accent-red); }
    .classified-stamp:hover {
        transform: rotate(5deg) scale(1.1);
        opacity: 1;
    }

    h1, .static-page h2 {
        font-size: 2.2rem; font-weight: 700; margin-bottom: 10px; text-align: center; color: var(--text-primary);
        position: relative; animation: text-shadow-flicker 4s linear infinite;
    }
    
    .feature-box h3 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 15px;
        color: var(--text-primary);
        position: relative;
        animation: text-shadow-flicker-small 3s linear infinite;
    }
    @keyframes text-shadow-flicker-small {
        0%, 100% { text-shadow: 1px 1px 0 var(--accent-green), -1px -1px 0 var(--accent-red); }
        25% { text-shadow: -1px 1px 0 var(--accent-green), 1px -1px 0 var(--accent-red); }
        50% { text-shadow: 1px -1px 0 var(--accent-green), -1px 1px 0 var(--accent-red); }
        75% { text-shadow: -1px -1px 0 var(--accent-green), 1px 1px 0 var(--accent-red); }
    }


    @keyframes text-shadow-flicker {
        0%, 100% { text-shadow: 2px 2px 0 var(--accent-green), -2px -2px 0 var(--accent-red); }
        25% { text-shadow: -2px 2px 0 var(--accent-green), 2px -2px 0 var(--accent-red); }
        50% { text-shadow: 2px -2px 0 var(--accent-green), -2px 2px 0 var(--accent-red); }
        75% { text-shadow: -2px -2px 0 var(--accent-green), 2px 2px 0 var(--accent-red); }
    }
    
    .tagline { 
      color: var(--text-secondary); margin-bottom: 30px; font-size: 16px; text-align: center;
      font-family: 'Roboto Mono', monospace; white-space: nowrap; overflow: hidden;
      border-right: .15em solid var(--accent-green); animation: typing 2s steps(38, end), blink-caret .75s step-end infinite;
    }
    #page-landing .tagline {
        animation: typing 2s steps(38, end) forwards;
        white-space: normal;
        overflow: visible;
        border-right: none;
    }
    @keyframes typing { from { width: 0 } to { width: 100% } }
    @keyframes blink-caret { from, to { border-color: transparent } 50% { border-color: var(--accent-green); } }

    .feature-boxes-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 40px;
        margin-bottom: 40px;
        justify-content: center;
    }
    .feature-box {
        flex: 1; 
        min-width: 280px; 
        background-color: var(--card-color);
        padding: 30px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        text-align: center;
        transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        will-change: transform, box-shadow, border-color;
    }
    .feature-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3), 0 0 15px var(--accent-green);
        border-color: var(--accent-green);
    }
    .feature-box .icon-wrapper {
        margin-bottom: 20px;
        color: var(--accent-green);
        font-size: 4rem;
        line-height: 1;
        transition: color 0.3s ease, transform 0.3s ease;
    }
    .feature-box:hover .icon-wrapper {
        transform: scale(1.1) rotate(5deg);
    }
    .feature-box p { color: var(--text-secondary); font-size: 0.95rem; line-height: 1.7; }
    .feature-box .highlight-text {
        color: var(--accent-blue);
        font-weight: 600;
        transition: color 0.3s ease;
    }
    
    .run-btn-wrapper { display: flex; justify-content: center; }
    button#run-btn, button#reset-btn, button.landing-scan-btn { 
      padding: 15px 30px; font-size: 18px; font-weight: 700; border: none; border-radius: 10px; 
      transition: all 0.3s ease; font-family: 'Inter', sans-serif; 
      will-change: transform, box-shadow;
    }
    button#run-btn, button.landing-scan-btn { background: var(--accent-green); color: #000; box-shadow: 0 0 15px rgba(0, 255, 136, 0.3); }
    button#run-btn:hover, button.landing-scan-btn:hover { background-color: #00e67a; transform: translateY(-3px) scale(1.02); box-shadow: 0 0 25px rgba(0, 255, 136, 0.6); }
    
    button#reset-btn.safe-button { background-image: linear-gradient(45deg, #00ff88, #00e67a); color: #000; box-shadow: 0 0 20px rgba(0, 255, 136, 0.4); }
    button#reset-btn.safe-button:hover { transform: translateY(-2px); box-shadow: 0 0 30px rgba(0, 255, 136, 0.7); }
    button#reset-btn.danger-button { background-image: linear-gradient(45deg, #ff4757, #e03f4f); color: #fff; box-shadow: 0 0 20px rgba(255, 71, 87, 0.5); }
    button#reset-btn.danger-button:hover { transform: translateY(-2px); box-shadow: 0 0 30px rgba(255, 71, 87, 0.8); }
    
    #results-container { margin-top: 30px; text-align: left; }
    .loader-wrapper { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 0; animation: page-transition-in 0.5s; }
    .scanner-circle { width: 60px; height: 60px; border: 4px solid var(--border-color); border-top-color: var(--accent-green); border-radius: 50%; animation: spin 1s linear infinite, pulse 2s ease-in-out infinite; will-change: transform, box-shadow; }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(0, 255, 138, 0.4); } 50% { box-shadow: 0 0 0 10px rgba(0, 255, 138, 0); } }
    .scanner-text { margin-top: 20px; color: var(--text-secondary); font-weight: 500; letter-spacing: 1px; text-transform: uppercase; }
    
    .verdict-box { padding: 20px; font-size: 22px; font-weight: 700; border-radius: 12px; border: 2px solid; display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 25px; animation: pulse-border 2s infinite; will-change: transform, box-shadow; }
    .verdict-box.safe { background-color: var(--success-bg); border-color: var(--accent-green); color: var(--accent-green); box-shadow: 0 0 20px rgba(0, 255, 136, 0.3); }
    .verdict-box.danger { background-color: var(--danger-bg); border-color: var(--accent-red); color: var(--accent-red); box-shadow: 0 0 20px rgba(255, 71, 87, 0.4); }
    @keyframes pulse-border { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.01); } }
    
    .risk-score { font-size: 16px; color: var(--text-secondary); text-align: center; margin-bottom: 25px; }
    .risk-score strong { color: var(--text-primary); font-weight: 700; font-size: 18px; }
    
    .details-grid { display: grid; grid-template-columns: auto 1fr; gap: 12px 20px; padding: 20px 0; border-top: 1px solid var(--border-color); font-family: 'Roboto Mono', monospace; align-items: baseline; }
    .details-grid > * { opacity: 0; animation: fade-in-up 0.5s ease forwards; will-change: opacity, transform; }
    @keyframes fade-in-up { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .details-grid .label { color: var(--text-secondary); text-align: right; white-space: pre; font-size: 14px; }
    .details-grid .value { color: var(--text-primary); font-size: 14px; word-break: break-all; }
    .details-grid .value.danger { color: var(--accent-red); font-weight: 700; }
    .details-grid .value.safe { color: var(--accent-green); }
    .details-grid .value.fingerprint-hash { color: var(--accent-blue); font-size: 13px;}

    .results-footer { text-align: center; padding-top: 30px; animation: fade-in-up 0.5s 0.5s ease forwards; opacity: 0; will-change: opacity, transform; }
    .results-separator {
        width: 60%; margin: 0 auto 25px auto; height: 1px; 
        background-image: linear-gradient(to right, transparent, var(--border-color), transparent);
        display: flex; align-items: center; justify-content: center;
    }
    .results-separator::after {
        font-family: 'Font Awesome 6 Free'; font-weight: 900;
        content: '\f1e2';
        font-size: 16px; color: var(--accent-green);
        background: var(--card-color); padding: 0 15px;
        animation: pulse-icon-safe 2s infinite ease-in-out; will-change: transform, text-shadow;
    }
    .results-separator.danger::after { color: var(--accent-red); animation-name: pulse-icon-danger; }
    @keyframes pulse-icon-safe { 0%, 100% { transform: scale(1); text-shadow: 0 0 5px var(--accent-green); } 50% { transform: scale(1.1); text-shadow: 0 0 15px var(--accent-green); } }
    @keyframes pulse-icon-danger { 0%, 100% { transform: scale(1); text-shadow: 0 0 5px var(--accent-red); } 50% { transform: scale(1.1); text-shadow: 0 0 15px var(--accent-red); } }
    
    .static-page p { color: var(--text-secondary); margin-bottom: 20px; line-height: 1.7; font-family: 'Roboto Mono', monospace; }
    .static-page h3 { color: var(--accent-blue); margin-top: 30px; margin-bottom: 10px; font-family: 'Roboto Mono', monospace; }
    
    .contact-form .form-group { margin-bottom: 20px; }
    .contact-form input, .contact-form textarea { width: 100%; background-color: var(--bg-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; color: var(--text-primary); font-size: 15px; transition: all 0.2s ease; font-family: 'Roboto Mono', monospace; }
    .contact-form input:focus, .contact-form textarea:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 0 10px rgba(0,170,255,0.5); }
    .contact-form textarea { resize: vertical; min-height: 120px; }
    .captcha-group { display: flex; align-items: center; flex-wrap: nowrap; gap: 15px; background-color: var(--bg-color); padding: 10px; border-radius: 8px; border: 1px solid var(--border-color); }
    .captcha-group label { color: var(--accent-green); font-family: 'Roboto Mono', monospace; white-space: nowrap; }
    .captcha-group input { border: none !important; box-shadow: none !important; }
    .form-submit-btn { width: 100%; padding: 15px; background: var(--accent-blue); color: #fff; border: none; border-radius: 10px; font-weight: 700; font-size: 16px; box-shadow: 0 0 15px rgba(0,170,255, 0.3); transition: all 0.3s ease; }
    .form-submit-btn:hover:not(:disabled) { background-color: #0099e6; transform: translateY(-2px); box-shadow: 0 0 25px rgba(0,170,255, 0.6); }
    .form-submit-btn:disabled { background-color: var(--text-secondary); cursor: not-allowed; }
    #form-response { text-align: center; margin-top: 15px; font-weight: 700; }
    #form-response.success { color: var(--accent-green); }
    #form-response.error { color: var(--accent-red); }

    /* Scroll Animation */
    .scroll-anim {
      opacity: 0;
      transform: translateY(30px);
      transition: opacity var(--scroll-anim-duration) var(--scroll-anim-ease),
                  transform var(--scroll-anim-duration) var(--scroll-anim-ease);
      transition-delay: var(--scroll-anim-delay);
      will-change: opacity, transform;
    }
    .scroll-anim.is-visible {
      opacity: 1;
      transform: translateY(0);
    }
    /* End Scroll Animation */

    /* Background Detected Targets for Landing Page */
    #page-landing .detected-targets-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        pointer-events: none;
        z-index: -1; /* Behind the container, but above canvas bg */
    }

    .detected-target {
        position: absolute;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        filter: grayscale(100%) brightness(50%) contrast(150%) blur(1px); /* Detected look */
        opacity: 0.08; /* Subtle presence */
        transform: rotate(var(--rotate-deg, 0deg)); /* Rotation for flair */
        animation: glitch-flicker 4s infinite alternate ease-in-out;
        will-change: transform, opacity, filter;
    }

    .detected-target::before {
        content: '';
        position: absolute;
        inset: 0;
        /* Creates a red X */
        background: 
            linear-gradient(to top left, transparent calc(50% - 1px), var(--accent-red) calc(50% - 1px), var(--accent-red) calc(50% + 1px), transparent calc(50% + 1px)), 
            linear-gradient(to top right, transparent calc(50% - 1px), var(--accent-red) calc(50% - 1px), var(--accent-red) calc(50% + 1px), transparent calc(50% + 1px));
        opacity: 0.8; /* Stronger red X */
        mix-blend-mode: multiply; /* Blends nicely with the filtered image */
        transform: scale(0.9); /* Slightly smaller X than the image itself */
        animation: cross-flicker 3s infinite alternate ease-in-out;
        will-change: opacity, transform;
    }

    /* Specific positioning and size for each target */
    .detected-target-iproyal {
        /* REPLACE THIS URL WITH YOUR IPROYAL LOGO IMAGE */
        background-image: url('https://via.placeholder.com/150x50/333/00ff88?text=IPROYAL'); /* Placeholder */
        width: 25vw; /* Responsive width */
        height: 8.3vw; /* Maintain aspect ratio (150/50 = 3) */
        top: 15%;
        left: 5%;
        --rotate-deg: -10deg;
        animation-delay: 0.5s;
    }

    .detected-target-adspower {
        /* REPLACE THIS URL WITH YOUR ADSPOWER LOGO IMAGE */
        background-image: url('https://via.placeholder.com/200x50/333/00aaff?text=ADSPOWER'); /* Placeholder */
        width: 30vw; /* Responsive width */
        height: 7.5vw; /* Maintain aspect ratio (200/50 = 4) */
        bottom: 10%;
        right: 10%;
        --rotate-deg: 15deg;
        animation-delay: 1.2s;
    }

    @keyframes glitch-flicker {
        0%, 100% { opacity: 0.08; transform: rotate(var(--rotate-deg, 0deg)) scale(1); }
        50% { opacity: 0.05; transform: rotate(var(--rotate-deg, 0deg)) scale(0.99); filter: grayscale(100%) brightness(40%) contrast(200%) blur(0.5px); }
        90% { opacity: 0.09; transform: rotate(var(--rotate-deg, 0deg)) scale(1.01); }
    }

    @keyframes cross-flicker {
        0%, 100% { opacity: 0.8; }
        25% { opacity: 0.6; }
        75% { opacity: 0.9; }
    }
    /* End Background Detected Targets */

    /* General Responsiveness */
    @media (max-width: 1024px) {
        header { padding: 0 30px; }
        main { padding: 40px 20px; }
        .container { padding: 25px 30px; }
        h1, .static-page h2 { font-size: 2rem; }
        .feature-box h3 { font-size: 1.4rem; }
        .feature-box .icon-wrapper { font-size: 3.5rem; }

        /* Background targets adjustments */
        .detected-target-iproyal { width: 35vw; height: 11.6vw; top: 10%; left: 3%; }
        .detected-target-adspower { width: 40vw; height: 10vw; bottom: 8%; right: 5%; }
    }

    @media (max-width: 768px) {
        header { padding: 0 20px; }
        nav .nav-link, nav #theme-toggle-btn { display: none; }
        #hamburger-btn { display: block; }
        nav { 
          position: fixed; top: 0; right: -100%; width: 100%; height: 100vh; 
          background: var(--nav-overlay-bg);
          backdrop-filter: blur(10px); 
          -webkit-backdrop-filter: blur(10px); 
          flex-direction: column; justify-content: center; align-items: center; gap: 40px; transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); 
        }
        nav.is-open { right: 0; }
        nav.is-open .nav-link, nav.is-open #theme-toggle-btn, nav.is-open #close-nav-btn { display: block; font-size: 24px; }
        .container { padding: 20px; }
        h1, .static-page h2 { font-size: 24px; }
        .details-grid { grid-template-columns: 1fr; text-align: center; }
        .details-grid .label { text-align: center; }
        .details-grid .value { margin-bottom: 16px; }
        .feature-boxes-grid { flex-direction: column; }
        .feature-box { min-width: unset; }
        .feature-box h3 { font-size: 1.3rem; }
        .feature-box .icon-wrapper { font-size: 3rem; }
        .classified-stamp { font-size: 16px; padding: 4px 8px; top: 15px; right: 15px; }

        /* Background targets adjustments for smaller screens */
        .detected-target-iproyal { width: 45vw; height: 15vw; top: 15%; left: 0%; }
        .detected-target-adspower { width: 55vw; height: 13.75vw; bottom: 5%; right: 0%; }
    }

    @media (max-width: 480px) {
        h1, .static-page h2 { font-size: 20px; }
        .tagline { font-size: 14px; }
        .feature-box { padding: 20px; }
        .feature-box h3 { font-size: 1.2rem; }
        button#run-btn, button#reset-btn, button.landing-scan-btn { padding: 12px 25px; font-size: 16px; }
        .verdict-box { font-size: 18px; padding: 15px; }
        .details-grid .label, .details-grid .value { font-size: 13px; }

        /* Even smaller targets for very small screens */
        .detected-target-iproyal { width: 60vw; height: 20vw; top: 10%; left: -5%; }
        .detected-target-adspower { width: 70vw; height: 17.5vw; bottom: 0%; right: -5%; }
    }
  </style>
</head>
<body>

<canvas id="matrix-bg"></canvas>
<div id="background-watermark"></div>

<div class="page-wrapper">
  <header class="scroll-anim">
    <a href="/" class="logo-link">
      <div class="logo">
        <i class="fa-solid fa-shield-halved"></i>
        <span>SpectraScan</span>
      </div>
    </a>
    <button id="hamburger-btn" aria-label="Open menu"><i class="fa-solid fa-bars"></i></button>
    <nav id="main-nav">
        <button id="close-nav-btn" aria-label="Close menu"><i class="fa-solid fa-times"></i></button>
        <a href="/" class="nav-link">Home</a>
        <a href="/checker" class="nav-link">Checker</a>
        <a href="/faq" class="nav-link">FAQ</a>
        <a href="/privacy" class="nav-link">Privacy</a>
        <a href="/contact" class="nav-link">Contact</a>
        <button id="theme-toggle-btn" title="Toggle theme"><i class="fa-solid fa-moon"></i></button>
    </nav>
  </header>

  <main>
    <div id="page-landing" class="page">
      <!-- New: Detected Targets Background -->
      <div class="detected-targets-background">
        <div class="detected-target detected-target-iproyal"></div>
        <div class="detected-target detected-target-adspower"></div>
      </div>
      <!-- End New: Detected Targets Background -->

      <div class="container scroll-anim">
        <div class="classified-stamp">CLASSIFIED</div>
        <h1>SpectraScan: Your Guardian Against Digital Disguises</h1>
        <p class="tagline">Unmasking the Shadows. Protecting Your Digital Integrity.</p>
        
        <div class="feature-boxes-grid">
          <div class="feature-box scroll-anim" style="--scroll-anim-delay: 0.1s;">
            <div class="icon-wrapper"><i class="fa-solid fa-fingerprint"></i></div>
            <h3>Advanced Digital Fingerprint Analysis</h3>
            <p>SpectraScan delivers cutting-edge digital fingerprinting and anomaly detection. We meticulously analyze your browser's unique characteristics to expose sophisticated attempts at identity spoofing and origin masking, ensuring unparalleled transparency.</p>
          </div>
          <div class="feature-box scroll-anim" style="--scroll-anim-delay: 0.2s;">
            <div class="icon-wrapper"><i class="fa-solid fa-crosshairs"></i></div>
            <h3>Comprehensive Threat Coverage</h3>
            <p>We pinpoint major anti-detect browsers like <span class="highlight-text">Dolphin Anty</span>, <span class="highlight-text">GoLogin</span>, and <span class="highlight-text">AdsPower</span>. Our detection also covers <span class="highlight-text">Oxylabs residential</span> proxies and general <span class="highlight-text">VPNs</span>, ensuring comprehensive security.</p>
          </div>
        </div>

        <div class="run-btn-wrapper scroll-anim" style="--scroll-anim-delay: 0.3s;">
          <button class="landing-scan-btn" onclick="navigateToChecker()">Scan Fingerprint Now</button>
        </div>
      </div>
    </div>

    <div id="page-checker" class="page">
      <div class="container scroll-anim" id="checker-container">
        <div class="classified-stamp">CLASSIFIED</div>
        <div id="intro-content">
          <h1>Unmask Your Digital Ghost</h1>
          <p class="tagline">Is your browser hiding in the shadows? Let's find out.</p>
          <div class="run-btn-wrapper">
            <button id="run-btn" onclick="runDetection()">Run Detection</button>
          </div>
        </div>
        <div id="results-container"></div>
      </div>
    </div>
    
    <div id="page-faq" class="page">
        <div class="container static-page scroll-anim">
          <h2>Frequently Asked Questions</h2>
          <h3 class="scroll-anim" style="--scroll-anim-delay: 0.1s;">What is this tool?</h3><p class="scroll-anim" style="--scroll-anim-delay: 0.15s;">SpectraScan analyzes your browser's fingerprint for signs of manipulation. Websites use these fingerprints to track you. Our tool checks for common spoofing techniques and flags connections from known VPNs or proxies.</p>
          <h3 class="scroll-anim" style="--scroll-anim-delay: 0.2s;">Why is a high risk score bad?</h3><p class="scroll-anim" style="--scroll-anim-delay: 0.25s;">A high score suggests your fingerprint is inconsistent, a common trait of antidetect browsers. While used for privacy, these browsers are often flagged as fraudulent by platforms like banks and e-commerce sites.</p>
          <h3 class="scroll-anim" style="--scroll-anim-delay: 0.3s;">Is this 100% accurate?</h3><p class="scroll-anim" style="--scroll-anim-delay: 0.35s;">No tool is infallible in the cat-and-mouse game of browser security. This tool provides a strong, indicative analysis, not absolute proof.</p>
        </div>
    </div>
    
    <div id="page-privacy" class="page">
        <div class="container static-page scroll-anim">
            <h2>Privacy Policy</h2>
            <p class="scroll-anim" style="--scroll-anim-delay: 0.1s;">Your privacy is paramount. Our policy is simple: we don't store your data.</p>
            <h3 class="scroll-anim" style="--scroll-anim-delay: 0.15s;">IP Address Handling</h3><p class="scroll-anim" style="--scroll-anim-delay: 0.2s;">Your IP address is used *only* to perform the check with third-party databases during your session. It is never logged or stored on our servers.</p>
            <h3 class="scroll-anim" style="--scroll-anim-delay: 0.25s;">Browser Fingerprint</h3><p class="scroll-anim" style="--scroll-anim-delay: 0.3s;">All fingerprinting happens in your browser. Raw data (WebGL, Canvas, etc.) is never sent to us. Your device performs the analysis locally.</p>
            <h3 class="scroll-anim" style="--scroll-anim-delay: 0.35s;">Cookies & Tracking</h3><p class="scroll-anim" style="--scroll-anim-delay: 0.4s;">This website does not use cookies for tracking. Period.</p>
        </div>
    </div>

    <div id="page-contact" class="page">
      <div class="container static-page scroll-anim">
        <h2>Initiate Contact</h2>
        <p>Your transmission will be relayed to our secure channel. Ensure your message is concise and accurate.</p>
        <form id="contact-form" class="contact-form">
          <div class="form-group scroll-anim" style="--scroll-anim-delay: 0.1s;"><input type="text" id="contact-name" name="name" placeholder="// Callsign (Name)" required></div>
          <div class="form-group scroll-anim" style="--scroll-anim-delay: 0.15s;"><input type="email" id="contact-email" name="email" placeholder="// Secure email for reply" required></div>
          <div class="form-group scroll-anim" style="--scroll-anim-delay: 0.2s;"><input type="text" id="contact-title" name="title" placeholder="// Subject of transmission" required></div>
          <div class="form-group scroll-anim" style="--scroll-anim-delay: 0.25s;"><textarea id="contact-description" name="description" placeholder="// Encrypted message..." required></textarea></div>
          <div class="form-group captcha-group scroll-anim" style="--scroll-anim-delay: 0.3s;">
            <label id="captcha-label" for="captcha-input"></label>
            <input type="text" id="captcha-input" name="captcha" placeholder="> " required autocomplete="off">
          </div>
          <button type="submit" id="submit-btn" class="form-submit-btn scroll-anim" style="--scroll-anim-delay: 0.35s;">Transmit Securely</button>
          <div id="form-response"></div>
        </form>
      </div>
    </div>
  </main>
  
  <footer class="scroll-anim">
    CLASSIFIED // FOR ANALYTICAL PURPOSES ONLY
    <div class="footer-icons">
      <i class="fa-solid fa-fingerprint"></i>
      <i class="fa-solid fa-bug"></i>
      <i class="fa-solid fa-user-secret"></i>
    </div>
  </footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

    /* --- Scroll-Triggered Animations --- */
    const scrollObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('is-visible');
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.scroll-anim').forEach(el => {
        scrollObserver.observe(el);
    });

    /* No custom cursor JS needed */
});
</script>

<script>
  /* --- NAVIGATION, THEME, ROUTER --- */
  const hamburgerBtn = document.getElementById('hamburger-btn'); 
  const closeNavBtn = document.getElementById('close-nav-btn'); 
  const mainNav = document.getElementById('main-nav');
  const body = document.body; /* Defined globally for background state changes */

  hamburgerBtn.addEventListener('click', () => mainNav.classList.add('is-open'));
  closeNavBtn.addEventListener('click', () => mainNav.classList.remove('is-open'));
  
  const themeToggleBtn = document.getElementById('theme-toggle-btn'); 
  
  function applySavedTheme() { 
    const savedTheme = localStorage.getItem('theme'); 
    if (savedTheme === 'light') { 
      body.classList.add('light-mode'); 
      themeToggleBtn.innerHTML = '<i class="fa-solid fa-sun"></i>';
    } else { 
      body.classList.remove('light-mode'); 
      themeToggleBtn.innerHTML = '<i class="fa-solid fa-moon"></i>';
    } 
  }
  
  themeToggleBtn.addEventListener('click', () => { 
    body.classList.toggle('light-mode'); 
    const isLight = body.classList.contains('light-mode');
    localStorage.setItem('theme', isLight ? 'light' : 'dark');
    themeToggleBtn.innerHTML = isLight ? '<i class="fa-solid fa-sun"></i>' : '<i class="fa-solid fa-moon"></i>';
    setBackgroundState('default'); /* Re-apply background based on new theme */
  });
  
  const pageContent = { 
      '/': 'page-landing', 
      '/checker': 'page-checker', 
      '/faq': 'page-faq', 
      '/privacy': 'page-privacy', 
      '/contact': 'page-contact' 
  };
  
  function showPageContent(pageId) {
    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
    const pageEl = document.getElementById(pageId);
    if(pageEl) pageEl.classList.add('active');

    document.querySelectorAll('.nav-link').forEach(link => {
      link.classList.remove('active');
      const linkPath = link.getAttribute('href');
      const currentPath = window.location.pathname;
      
      if (linkPath === currentPath || 
          (currentPath === '/' && linkPath === '/') || 
          (currentPath === '/checker' && linkPath === '/checker')) {
        link.classList.add('active');
      }
    });

    if (pageId === 'page-checker') {
        resetChecker(); 
    } else {
        /* Ensure background is reset if navigating away from checker */
        setBackgroundState('default'); 
    }
  }

  const router = () => { 
    const path = window.location.pathname; 
    const pageId = pageContent[path] || 'page-landing';
    showPageContent(pageId); 
  };
  
  document.addEventListener('click', (e) => { 
    const a = e.target.closest('a'); 
    if (a && (a.matches('.nav-link') || a.matches('.logo-link'))) { 
      e.preventDefault(); 
      history.pushState(null, '', a.href); 
      mainNav.classList.remove('is-open'); 
      router(); 
    }
  });

  function navigateToChecker() {
      history.pushState(null, '', '/checker');
      router();
  }
  
  window.addEventListener('popstate', router);
  
  document.addEventListener('DOMContentLoaded', () => { 
    applySavedTheme(); 
    router();
    if (document.getElementById('contact-form')) {
        initializeContactForm();
    }
  });

  /* --- CHECKER SCRIPT --- */
  function resetChecker() { 
      const intro = document.getElementById('intro-content');
      if (intro && intro.closest('#page-checker')) intro.style.display = 'block';
      const resultsContainer = document.getElementById('results-container');
      if (resultsContainer && resultsContainer.closest('#page-checker')) resultsContainer.innerHTML = ''; 
      setBackgroundState('default');
      const stamp = document.querySelector('#page-checker .classified-stamp');
      if(stamp) {
        stamp.classList.remove('safe', 'danger');
        stamp.textContent = "CLASSIFIED";
      }
  }

  window.runDetection = async function() {
    const intro = document.getElementById('intro-content');
    if (intro && intro.closest('#page-checker')) intro.style.display = 'none';
    const resultsEl = document.getElementById('results-container');
    resultsEl.innerHTML = `<div class="loader-wrapper"><div class="scanner-circle"></div><p class="scanner-text">INTERROGATING BROWSER...</p></div>`;
    const minDelay = new Promise(resolve => setTimeout(resolve, 2000));
    
    let riskScore = 0;
    const riskFactors = [];
    const browserFlags = {
        brave: false,
        tor: false,
        opera: false,
        heuristicsSpoofing: false,
        canvasRandomization: false,
        webglEmulation: false
    };
    const TARGET_CHROME_VERSION = "138"; 

    /* IP Check */
    try {
        const resp = await fetch('/api/ip-check', { cache: 'no-store' });
        const ipData = await resp.json();
        if (ipData.error) throw new Error("IP API Error");
        riskFactors.push({ label: 'IP Address', value: ipData.ip, isBad: false, alwaysShow: true });
        riskFactors.push({ label: 'VPN/Proxy', value: ipData.status, isBad: ipData.isProxy, alwaysShow: true });
        if (ipData.isProxy) riskScore += 3;
        if (ipData.status.includes('TOR')) riskScore += 5;
    } catch (e) {
        riskScore += 1;
        riskFactors.push({ label: 'IP/VPN Check', value: "Error during lookup", isBad: true, alwaysShow: true });
    }

    /* Browser Specific Detections */
    const ua = navigator.userAgent;
    const majorChromeVersion = (ua.match(/Chrome\/(\d+)/) || [])[1];
    
    if (navigator.brave && await navigator.brave.isBrave()) {
        riskScore += 3;
        browserFlags.brave = true;
    }
    if (getCanvasEntropy() === 2001009873) { /* Known Tor Browser canvas entropy */
        riskScore += 5;
        browserFlags.tor = true;
    }
    if (typeof window.opr !== 'undefined' || ua.includes("OPR")) {
        riskScore += 2;
        browserFlags.opera = true;
    }

    /* Heuristics-based Spoofing Detection */
    let currentHeuristicsScore = 0;
    if (!ua.includes("Chrome") || majorChromeVersion !== TARGET_CHROME_VERSION) { currentHeuristicsScore += 4; }
    if (navigator.webdriver) { currentHeuristicsScore += 4; }
    if (navigator.plugins && navigator.plugins.length === 5) { currentHeuristicsScore += 1; }
    if (navigator.languages && navigator.languages.length === 4) { currentHeuristicsScore += 2; }
    const proResolutions = ['1920x1080', '2560x1440', '3840x2160'];
    const currentRes = `${window.screen.width}x${window.screen.height}`;
    if (majorChromeVersion === TARGET_CHROME_VERSION && !proResolutions.includes(currentRes)) { currentHeuristicsScore += 2; }
    
    riskScore += currentHeuristicsScore;
    if (currentHeuristicsScore >= 4) {
        browserFlags.heuristicsSpoofing = true;
    }
    
    /* Canvas Fingerprint Randomization */
    const canvasHash1 = getCanvasEntropy();
    await new Promise(resolve => setTimeout(resolve, 30));
    const canvasHash2 = getCanvasEntropy();
    if (canvasHash1 !== canvasHash2) {
        riskScore += 2;
        browserFlags.canvasRandomization = true;
    }

    /* WebGL Emulation */
    const renderer = getWebGLInfo().renderer.toLowerCase();
    if (renderer.includes("swiftshader") || renderer.includes("llvmpipe")) {
        riskScore += 3;
        browserFlags.webglEmulation = true;
    }

    /* Determine overall verdict based on total riskScore */
    const isBadBrowserOverall = riskScore >= 3; 
    setBackgroundState(isBadBrowserOverall ? 'danger' : 'safe');
    
    /* Construct the 'Browser' risk factor message */
    let browserLabelValue = 'Normal';
    let browserLabelIsBad = false;

    if (browserFlags.heuristicsSpoofing || browserFlags.canvasRandomization || browserFlags.webglEmulation) {
        browserLabelValue = 'Antidetect Browser Detected';
        browserLabelIsBad = true;
    } else if (browserFlags.tor) {
        browserLabelValue = 'Tor Browser (High Risk)';
        browserLabelIsBad = true;
    } else if (browserFlags.brave) {
        browserLabelValue = 'Brave Browser';
        if (isBadBrowserOverall) {
            browserLabelValue += ' (Antidetect Tendencies)';
            browserLabelIsBad = true;
        } else {
            browserLabelIsBad = false; 
        }
    } else if (browserFlags.opera) {
        browserLabelValue = 'Opera Browser';
        if (isBadBrowserOverall) {
            browserLabelValue += ' (Suspicious)';
            browserLabelIsBad = true;
        } else {
            browserLabelIsBad = false;
        }
    } else if (isBadBrowserOverall) {
        browserLabelValue = 'Suspicious Profile (Antidetect Characteristics)';
        browserLabelIsBad = true;
    }
    riskFactors.push({ label: 'Browser', value: browserLabelValue, isBad: browserLabelIsBad, alwaysShow: true });

    const verdict = isBadBrowserOverall ? "High Risk Profile Detected" : "Profile Appears Normal";
    
    let resultsHTML = `<div class="verdict-box ${isBadBrowserOverall ? 'danger' : 'safe'}"><i class="fa-solid ${isBadBrowserOverall ? 'fa-user-secret' : 'fa-user-check'} fa-lg"></i><span>${verdict}</span></div>`;
    resultsHTML += `<div class="risk-score">Threat Score: <strong>${riskScore}</strong></div>`;
    
    const displayableRiskFactors = riskFactors.filter(factor => factor.isBad || factor.alwaysShow);
    let detailsGridHTML = displayableRiskFactors.map((factor, index) => {
        let valueClass = 'value';
        if (factor.isBad) valueClass += ' danger';
        else if (!factor.isHash) valueClass += ' safe';
        if (factor.isHash) valueClass += ' fingerprint-hash';
        let labelHTML = `<div class="label" style="animation-delay: ${index * 0.05}s">${factor.label}:</div>`;
        let valueHTML = `<div class="${valueClass}" style="animation-delay: ${index * 0.05}s">${factor.value}</div>`;
        return labelHTML + valueHTML;
    }).join('');
    
    resultsHTML += `<div class="details-grid">${displayableRiskFactors.length > 0 ? detailsGridHTML : '<div style="grid-column: 1 / -1; text-align: center; color: var(--accent-green);">All checks passed.</div>' }</div>`;
    resultsHTML += `<div class="results-footer"><div class="results-separator ${isBadBrowserOverall ? 'danger' : ''}"></div><div class="run-btn-wrapper"><button id="reset-btn" onclick="resetChecker()">Run Another Test</button></div></div>`;
    
    const [resultHtmlContent] = await Promise.all([Promise.resolve(resultsHTML), minDelay]);
    
    resultsEl.innerHTML = resultHtmlContent;
    
    const resetButton = document.getElementById('reset-btn');
    if (resetButton) {
        resetButton.classList.add(isBadBrowserOverall ? 'danger-button' : 'safe-button');
    }
  }
  
  function getCanvasEntropy() {try {const c=document.createElement('canvas'); const ctx=c.getContext('2d'); ctx.fillStyle="rgb(255,255,255)"; ctx.fillRect(0,0,c.width,c.height); c.width=200;c.height=50;ctx.textBaseline="top";ctx.font="14px 'Arial'";ctx.fillText("BrowserFP",2,2);return hashString(c.toDataURL())}catch{return null}}
  function hashString(s){let h=0;for(let i=0;i<s.length;i++){h=((h<<5)-h)+s.charCodeAt(i);h|=0}return h}
  function getWebGLInfo(){try{const c=document.createElement('canvas');const gl=c.getContext('webgl')||c.getContext('experimental-webgl');if(!gl){return{vendor:"N/A",renderer:"N/A"}}const dbg=gl.getExtension('WEBGL_debug_renderer_info');return{vendor:gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL),renderer:gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL)}}catch{return{vendor:"N/A",renderer:"N/A"}}}
  
  /* --- CONTACT FORM SCRIPT --- */
  function initializeContactForm() {
    const form = document.getElementById('contact-form');
    if(!form) return;
    const captchaLabel = document.getElementById('captcha-label');
    const captchaInput = document.getElementById('captcha-input');
    const submitBtn = document.getElementById('submit-btn');
    const formResponse = document.getElementById('form-response');

    let num1, num2, answer;

    function generateCaptcha() {
        num1 = Math.floor(Math.random() * 10) + 1;
        num2 = Math.floor(Math.random() * 10) + 1;
        answer = num1 + num2;
        captchaLabel.textContent = `Calculate: ${num1} + ${num2} =`;
        captchaInput.value = '';
    }

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        if (parseInt(captchaInput.value, 10) !== answer) {
            formResponse.textContent = 'ERROR: Incorrect Security Code';
            formResponse.className = 'error';
            generateCaptcha();
            return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'TRANSMITTING...';
        formResponse.textContent = '';
        
        const formData = {
            name: document.getElementById('contact-name').value,
            email: document.getElementById('contact-email').value,
            title: document.getElementById('contact-title').value,
            description: document.getElementById('contact-description').value
        };

        try {
            const response = await fetch('/api/contact', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });
            const result = await response.json();

            if (response.ok) {
                formResponse.textContent = `SUCCESS: Your ticket ID is ${result.ticketId}`;
                formResponse.className = 'success';
                form.reset();
            } else { 
                throw new Error(result.message || 'Server rejected the transmission.'); 
            }
        } catch (error) {
            formResponse.textContent = `TRANSMISSION FAILED: ${error.message}`;
            formResponse.className = 'error';
        } finally {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Transmit Securely';
            generateCaptcha();
        }
    });

    generateCaptcha();
  }

  /* --- DYNAMIC BACKGROUND SCRIPT --- */
  const canvas = document.getElementById('matrix-bg');
  const ctx = canvas.getContext('2d');
  let animationFrameId; /* To store the requestAnimationFrame ID for stopping the loop */

  const setupCanvas = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    /* Re-call setBackgroundState to restart animation with new dimensions */
    setBackgroundState(body.classList.contains('danger-mode') ? 'danger' : (body.classList.contains('safe-mode') ? 'safe' : 'default'));
  };

  const drawMatrixFrame = (color, fontSize, drops, characters) => {
    const bg = body.classList.contains('light-mode') ? 'rgba(244, 244, 248, 0.05)' : 'rgba(13, 13, 18, 0.05)';
    ctx.fillStyle = bg;
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = color;
    ctx.font = fontSize + 'px Roboto Mono';

    for (let i = 0; i < drops.length; i++) {
        const text = characters[Math.floor(Math.random() * characters.length)];
        ctx.fillText(text, i * fontSize, drops[i] * fontSize);
        if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
        drops[i]++;
    }
    animationFrameId = requestAnimationFrame(() => drawMatrixFrame(color, fontSize, drops, characters));
  };

  let scanLineOffset = 0;
  let scanDirection = 1; /* 1 for horizontal, 0 for vertical */
  const drawScanningLinesFrame = (color, speed) => {
    const isLight = body.classList.contains('light-mode');
    const baseColor = isLight ? 'rgba(0, 170, 255, 0.2)' : 'rgba(0, 255, 136, 0.15)';
    const secondaryColor = isLight ? 'rgba(0, 170, 255, 0.05)' : 'rgba(0, 255, 136, 0.05)';
    const fadeColor = body.classList.contains('light-mode') ? 'rgba(244, 244, 248, 0.08)' : 'rgba(13, 13, 18, 0.08)';

    ctx.fillStyle = fadeColor;
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.strokeStyle = baseColor;
    ctx.lineWidth = 1;

    const scanSpeed = 1.5; /* Pixels per frame */
    const scanWidth = 100; /* Width of the "scan" area */

    if (scanDirection === 1) { /* Horizontal scan */
        scanLineOffset = (scanLineOffset + scanSpeed);
        if (scanLineOffset > canvas.width + scanWidth) scanLineOffset = -scanWidth;

        for (let i = 0; i < canvas.height; i += 20) {
            const lineX = scanLineOffset + (Math.sin(i * 0.1 + scanLineOffset * 0.01) * 10);
            ctx.beginPath();
            ctx.moveTo(lineX, i);
            ctx.lineTo(lineX + 50, i);
            ctx.stroke();

            ctx.strokeStyle = secondaryColor;
            ctx.beginPath();
            ctx.moveTo(lineX - 10, i);
            ctx.lineTo(lineX + 40, i);
            ctx.stroke();
        }
    } else { /* Vertical scan (alternative, not currently used) */
        scanLineOffset = (scanLineOffset + scanSpeed);
        if (scanLineOffset > canvas.height + scanWidth) scanLineOffset = -scanWidth;

        for (let i = 0; i < canvas.width; i += 20) {
            const lineY = scanLineOffset + (Math.sin(i * 0.1 + scanLineOffset * 0.01) * 10);
            ctx.beginPath();
            ctx.moveTo(i, lineY);
            ctx.lineTo(i, lineY + 50);
            ctx.stroke();

            ctx.strokeStyle = secondaryColor;
            ctx.beginPath();
            ctx.moveTo(i, lineY - 10);
            ctx.lineTo(i, lineY + 40);
            ctx.stroke();
        }
    }
    animationFrameId = requestAnimationFrame(() => drawScanningLinesFrame(color, speed));
  };

  function setBackgroundState(state) {
      const watermark = document.getElementById('background-watermark');
      const currentPath = window.location.pathname;
      const currentPageId = pageContent[currentPath] || 'page-landing';
      const currentPageElement = document.getElementById(currentPageId);
      const classifiedStamp = currentPageElement ? currentPageElement.querySelector('.classified-stamp') : null;

      /* Stop any ongoing animation frame loop */
      if (animationFrameId) {
          cancelAnimationFrame(animationFrameId);
      }
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      const isLight = body.classList.contains('light-mode');

      /* Hide/show detected target images based on page */
      const detectedTargetsBg = document.querySelector('#page-landing .detected-targets-background');
      if (detectedTargetsBg) {
          detectedTargetsBg.style.display = (currentPageId === 'page-landing') ? 'block' : 'none';
      }

      body.classList.remove('safe-mode', 'danger-mode');

      if (state === 'danger') {
          const matrixColor = isLight ? 'rgba(255, 71, 87, 0.4)' : 'rgba(255, 71, 87, 0.7)';
          const fontSize = 14;
          const columns = canvas.width / fontSize;
          const drops = Array(Math.floor(columns)).fill(1);
          animationFrameId = requestAnimationFrame(() => drawMatrixFrame(matrixColor, fontSize, drops, '01'));

          watermark.setAttribute('data-text', 'COMPROMISED');
          body.classList.add('danger-mode');
          if (classifiedStamp) {
              classifiedStamp.textContent = "COMPROMISED";
              classifiedStamp.classList.add('danger');
              classifiedStamp.classList.remove('safe');
          }
      } else if (state === 'safe') {
          animationFrameId = requestAnimationFrame(() => drawScanningLinesFrame(isLight ? 'rgba(0, 170, 255, 0.2)' : 'rgba(0, 255, 136, 0.15)', 50));
          watermark.setAttribute('data-text', 'UNCLASSIFIED');
          body.classList.add('safe-mode');
          if (classifiedStamp) {
              classifiedStamp.textContent = "UNCLASSIFIED";
              classifiedStamp.classList.add('safe');
              classifiedStamp.classList.remove('danger');
          }
      } else { /* default */
          animationFrameId = requestAnimationFrame(() => drawScanningLinesFrame(isLight ? 'rgba(0, 170, 255, 0.2)' : 'rgba(0, 255, 136, 0.15)', 50));
          watermark.setAttribute('data-text', '');
          if(classifiedStamp) {
              classifiedStamp.textContent = "CLASSIFIED";
              classifiedStamp.classList.remove('safe', 'danger');
          }
      }
  }

  /* Debounce resize events for performance */
  let resizeTimer;
  window.addEventListener('resize', () => {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(setupCanvas, 250); /* Wait 250ms after resizing stops */
  });
  
  document.addEventListener('DOMContentLoaded', setupCanvas);
</script>

</body>
</html>