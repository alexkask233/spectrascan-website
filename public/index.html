<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üõ°Ô∏è SpectraScan - Unmask Your Digital Ghost</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20448%20512'%3E%3Cpath%20fill='%2300ff88'%20d='M224%20256A128%20128%200%201%200%20224%200a128%20128%200%201%200%200%20256zm-45.7%2048C79.8%20304%200%20383.8%200%20482.3C0%20498.7%2013.3%20512%2029.7%20512H418.3c16.4%200%2029.7-13.3%2029.7-29.7C448%20383.8%20368.2%20304%20269.7%20304H178.3z'/%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  
  <script src="https://cdn.jsdelivr.net/npm/@thumbmarkjs/thumbmarkjs/dist/thumbmark.umd.js"></script>

  <style>
    :root {
      --bg-color: #0d0d12; --card-color: rgba(30, 30, 36, 0.9); --border-color: #33333a; --text-primary: #f0f0f0; --text-secondary: #a9a9b3; --accent-green: #00ff88; --accent-red: #ff4757; --accent-blue: #00aaff; --success-bg: rgba(0, 255, 136, 0.1); --danger-bg: rgba(255, 71, 87, 0.1); --bg-grid-color: #2a2a30;
    }
    
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    html { height: 100%; }
    body {
        height: 100%; background-color: var(--bg-color); color: var(--text-primary); font-family: 'Inter', sans-serif; line-height: 1.6; position: relative; overflow: hidden;
    }
    #matrix-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; transition: opacity 0.5s ease-in-out; }
    
    .page-wrapper { display: flex; flex-direction: column; height: 100%; overflow-y: auto; }
    
    #background-watermark {
        content: attr(data-text); position: fixed; top: 50%; left: 50%;
        transform: translate(-50%, -50%) rotate(-15deg);
        font-size: 15vw; font-family: 'Roboto Mono', monospace; font-weight: 700;
        opacity: 0; pointer-events: none; z-index: -1; transition: opacity 0.5s ease;
    }
    body.danger-mode #background-watermark {
        color: var(--accent-red); text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
        opacity: 0.1; animation: watermark-flicker 2s infinite alternate;
    }
    body.safe-mode #background-watermark {
        color: var(--accent-blue); text-shadow: 0 0 10px rgba(0, 170, 255, 0.5);
        opacity: 0.05; animation: watermark-flicker 4s infinite alternate;
    }
    @keyframes watermark-flicker { 0%, 90% { opacity: 0.1; } 95% { opacity: 0.05; } 100% { opacity: 0.12; } }

    main { flex-grow: 1; display: flex; justify-content: center; align-items: center; padding: 40px 20px; }
    .page { display: none; width: 100%; max-width: 700px; }
    .page.active { display: block; animation: page-transition-in 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards; }
    @keyframes page-transition-in { from { opacity: 0; transform: translateY(20px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }

    header { background-color: rgba(18, 18, 23, 0.8); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); padding: 0 40px; display: flex; justify-content: space-between; align-items: center; height: 70px; position: sticky; top: 0; z-index: 100; transition: background-color 0.3s ease, border-color 0.3s ease; }
    .logo-link { text-decoration: none; }
    .logo { font-size: 20px; font-weight: 700; display: flex; align-items: center; gap: 10px; color: var(--text-primary); }
    .logo .fa-shield-halved { color: var(--accent-green); }
    nav { display: flex; align-items: center; gap: 30px; }
    nav .nav-link { color: var(--text-secondary); text-decoration: none; font-weight: 500; transition: color 0.2s ease; }
    nav .nav-link:hover, nav .nav-link.active { color: var(--text-primary); }
    #theme-toggle-btn { background: none; border: none; color: var(--text-secondary); font-size: 20px; cursor: pointer; transition: color 0.2s ease, transform 0.2s ease; }
    #hamburger-btn, #close-nav-btn { display: none; background: none; border: none; font-size: 24px; color: var(--text-primary); cursor: pointer; }
    #close-nav-btn { position: absolute; top: 20px; right: 20px; }
    
    footer { text-align: center; padding: 20px; color: var(--text-secondary); font-size: 14px; background-color: var(--card-color); border-top: 1px solid var(--border-color); margin-top: auto; transition: background-color 0.3s ease, border-color 0.3s ease; font-family: 'Roboto Mono', monospace; }
    footer .footer-icons { margin-top: 10px; display: flex; justify-content: center; gap: 20px; font-size: 18px; color: var(--accent-green); }
    
    .container { background-color: var(--card-color); padding: 30px 40px; border-radius: 16px; border: 1px solid var(--border-color); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2); transition: background-color 0.3s ease, border-color 0.3s ease; position: relative; overflow: hidden; }
    
    .classified-stamp {
        position: absolute; top: 25px; right: 25px;
        transform: rotate(10deg); color: var(--accent-red);
        border: 3px solid var(--accent-red); padding: 5px 10px;
        font-family: 'Roboto Mono', monospace; font-weight: 700;
        font-size: 18px; opacity: 0.7; user-select: none;
        animation: stamp-flicker 4s infinite alternate;
    }
    .classified-stamp.safe { animation-name: stamp-pulse-safe; border-color: var(--accent-green); color: var(--accent-green); }
    .classified-stamp.danger { animation-name: stamp-pulse-danger; border-color: var(--accent-red); color: var(--accent-red); }
    @keyframes stamp-pulse-safe { 0%, 100% { opacity: 0.7; } 50% { opacity: 0.9; } }
    @keyframes stamp-pulse-danger { 0%, 100% { opacity: 0.7; } 50% { opacity: 0.9; } }

    h1, .static-page h2 {
        font-size: 2.2rem; font-weight: 700; margin-bottom: 10px; text-align: center; color: var(--text-primary);
        position: relative; animation: text-flicker 3s linear infinite;
    }
    h1[data-text]::before, h1[data-text]::after, .static-page h2[data-text]::before, .static-page h2[data-text]::after {
        content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background: var(--card-color); overflow: hidden;
    }
    h1::before, .static-page h2::before { left: 3px; text-shadow: -2px 0 var(--accent-red); animation: glitch-anim-2 3s infinite linear alternate-reverse; }
    h1::after, .static-page h2::after { left: -3px; text-shadow: -2px 0 var(--accent-blue); animation: glitch-anim 3s infinite linear alternate-reverse; }
    @keyframes text-flicker { 0%, 19.9%, 22%, 62.9%, 64%, 64.9%, 70%, 100% { opacity: 0.99; } 20%, 21.9%, 63%, 63.9%, 65%, 69.9% { opacity: 0.4; } }
    @keyframes glitch-anim { 0% { clip-path: inset(40% 0 60% 0); } 10% { clip-path: inset(60% 0 10% 0); } 20%, 100% { clip-path: inset(50% 0 30% 0); } }
    @keyframes glitch-anim-2 { 0% { clip-path: inset(0 0 90% 0); } 15% { clip-path: inset(80% 0 5% 0); } 25%, 100% { clip-path: inset(40% 0 45% 0); } }

    .tagline { 
      color: var(--text-secondary); margin-bottom: 30px; font-size: 16px; text-align: center;
      font-family: 'Roboto Mono', monospace; white-space: nowrap; overflow: hidden;
      border-right: .15em solid var(--accent-green); animation: typing 2s steps(38, end), blink-caret .75s step-end infinite;
    }
    @keyframes typing { from { width: 0 } to { width: 100% } }
    @keyframes blink-caret { from, to { border-color: transparent } 50% { border-color: var(--accent-green); } }

    .run-btn-wrapper { display: flex; justify-content: center; }
    button#run-btn, button#reset-btn { padding: 15px 30px; font-size: 18px; font-weight: 700; border: none; border-radius: 10px; transition: all 0.3s ease; font-family: 'Inter', sans-serif; }
    button#run-btn { background: var(--accent-green); color: #000; box-shadow: 0 0 15px rgba(0, 255, 136, 0.3); }
    button#run-btn:hover { background-color: #00e67a; transform: translateY(-3px) scale(1.02); box-shadow: 0 0 25px rgba(0, 255, 136, 0.6); }
    
    button#reset-btn.safe-button { background-image: linear-gradient(45deg, #00ff88, #00e67a); color: #000; box-shadow: 0 0 20px rgba(0, 255, 136, 0.4); }
    button#reset-btn.safe-button:hover { transform: translateY(-2px); box-shadow: 0 0 30px rgba(0, 255, 136, 0.7); }
    button#reset-btn.danger-button { background-image: linear-gradient(45deg, #ff4757, #e03f4f); color: #fff; box-shadow: 0 0 20px rgba(255, 71, 87, 0.5); }
    button#reset-btn.danger-button:hover { transform: translateY(-2px); box-shadow: 0 0 30px rgba(255, 71, 87, 0.8); }
    
    #results-container { margin-top: 30px; text-align: left; }
    .loader-wrapper { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 0; animation: page-transition-in 0.5s; }
    .scanner-circle { width: 60px; height: 60px; border: 4px solid var(--border-color); border-top-color: var(--accent-green); border-radius: 50%; animation: spin 1s linear infinite, pulse 2s ease-in-out infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(0, 255, 138, 0.4); } 50% { box-shadow: 0 0 0 10px rgba(0, 255, 138, 0); } }
    .scanner-text { margin-top: 20px; color: var(--text-secondary); font-weight: 500; letter-spacing: 1px; text-transform: uppercase; }
    
    .verdict-box { padding: 20px; font-size: 22px; font-weight: 700; border-radius: 12px; border: 2px solid; display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 25px; animation: pulse-border 2s infinite; }
    .verdict-box.safe { background-color: var(--success-bg); border-color: var(--accent-green); color: var(--accent-green); box-shadow: 0 0 20px rgba(0, 255, 136, 0.3); }
    .verdict-box.danger { background-color: var(--danger-bg); border-color: var(--accent-red); color: var(--accent-red); box-shadow: 0 0 20px rgba(255, 71, 87, 0.4); }
    @keyframes pulse-border { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.01); } }
    
    .risk-score { font-size: 16px; color: var(--text-secondary); text-align: center; margin-bottom: 25px; }
    .risk-score strong { color: var(--text-primary); font-weight: 700; font-size: 18px; }
    
    .details-grid { display: grid; grid-template-columns: auto 1fr; gap: 12px 20px; padding: 20px 0; border-top: 1px solid var(--border-color); font-family: 'Roboto Mono', monospace; align-items: baseline; }
    .details-grid > * { opacity: 0; animation: fade-in-up 0.5s ease forwards; }
    .details-grid .label:nth-child(1), .details-grid .value:nth-child(2) { animation-delay: 0.1s; }
    .details-grid .label:nth-child(3), .details-grid .value:nth-child(4) { animation-delay: 0.2s; }
    .details-grid .label:nth-child(5), .details-grid .value:nth-child(6) { animation-delay: 0.3s; }
    @keyframes fade-in-up { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .details-grid .label { color: var(--text-secondary); text-align: right; white-space: pre; font-size: 14px; }
    .details-grid .value { color: var(--text-primary); font-size: 14px; word-break: break-all; }
    .details-grid .value.danger { color: var(--accent-red); font-weight: 700; }
    .details-grid .value.safe { color: var(--accent-green); }
    .details-grid .value.fingerprint-hash { color: var(--accent-blue); font-size: 13px;}

    .results-footer { text-align: center; padding-top: 30px; animation: fade-in-up 0.5s 0.5s ease forwards; opacity: 0; }
    .results-separator {
        width: 60%; margin: 0 auto 25px auto; height: 1px; 
        background-image: linear-gradient(to right, transparent, var(--border-color), transparent);
        display: flex; align-items: center; justify-content: center;
    }
    .results-separator::after {
        font-family: 'Font Awesome 6 Free'; font-weight: 900;
        content: '\f1e2'; /* fa-skull-crossbones */
        font-size: 16px; color: var(--accent-green);
        background: var(--card-color); padding: 0 15px;
        animation: pulse-icon-safe 2s infinite ease-in-out;
    }
    .results-separator.danger::after { color: var(--accent-red); animation-name: pulse-icon-danger; }
    @keyframes pulse-icon-safe { 0%, 100% { transform: scale(1); text-shadow: 0 0 5px var(--accent-green); } 50% { transform: scale(1.1); text-shadow: 0 0 15px var(--accent-green); } }
    @keyframes pulse-icon-danger { 0%, 100% { transform: scale(1); text-shadow: 0 0 5px var(--accent-red); } 50% { transform: scale(1.1); text-shadow: 0 0 15px var(--accent-red); } }
    
    .static-page p { color: var(--text-secondary); margin-bottom: 20px; line-height: 1.7; font-family: 'Roboto Mono', monospace; }
    .static-page h3 { color: var(--accent-blue); margin-top: 30px; margin-bottom: 10px; font-family: 'Roboto Mono', monospace; }
    .contact-form .form-group { margin-bottom: 20px; }
    .contact-form input, .contact-form textarea { width: 100%; background-color: var(--bg-color); border: 1px solid var(--border-color); border-radius: 8px; padding: 12px; color: var(--text-primary); font-size: 15px; transition: all 0.2s ease; font-family: 'Roboto Mono', monospace; }
    .contact-form input:focus, .contact-form textarea:focus { outline: none; border-color: var(--accent-blue); box-shadow: 0 0 10px rgba(0,170,255,0.5); }
    .contact-form textarea { resize: vertical; min-height: 120px; }
    .form-submit-btn { width: 100%; padding: 15px; background: var(--accent-blue); color: #fff; border: none; border-radius: 10px; font-weight: 700; font-size: 16px; box-shadow: 0 0 15px rgba(0,170,255, 0.3); }
    .form-submit-btn:hover { background-color: #0099e6; transform: translateY(-2px); box-shadow: 0 0 25px rgba(0,170,255, 0.6); }
    
    @media (max-width: 768px) {
        header { padding: 0 20px; }
        nav .nav-link, nav #theme-toggle-btn { display: none; }
        #hamburger-btn { display: block; }
        nav { position: fixed; top: 0; right: -100%; width: 100%; height: 100vh; background: rgba(18, 18, 23, 0.95); backdrop-filter: blur(10px); flex-direction: column; justify-content: center; align-items: center; gap: 40px; transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); }
        nav.is-open { right: 0; }
        nav.is-open .nav-link, nav.is-open #theme-toggle-btn, nav.is-open #close-nav-btn { display: block; font-size: 24px; }
        .container { padding: 20px; }
        h1, .static-page h2 { font-size: 24px; }
        .details-grid { grid-template-columns: 1fr; text-align: center; }
        .details-grid .label { text-align: center; }
        .details-grid .value { margin-bottom: 16px; }
    }
  </style>
</head>
<body>
<canvas id="matrix-bg"></canvas>
<div id="background-watermark"></div>

<div class="page-wrapper">
  <!-- ====== HEADER ====== -->
  <header>
    <a href="/" class="logo-link">
      <div class="logo">
        <i class="fa-solid fa-shield-halved"></i>
        <span>SpectraScan</span>
      </div>
    </a>
    <button id="hamburger-btn" aria-label="Open menu"><i class="fa-solid fa-bars"></i></button>
    <nav id="main-nav">
        <button id="close-nav-btn" aria-label="Close menu"><i class="fa-solid fa-times"></i></button>
        <a href="/" class="nav-link">Catcher</a>
        <a href="/faq" class="nav-link">FAQ</a>
        <a href="/privacy" class="nav-link">Privacy</a>
        <a href="/contact" class="nav-link">Contact</a>
        <button id="theme-toggle-btn" title="Toggle theme"><i class="fa-solid fa-moon"></i></button>
    </nav>
  </header>

  <!-- ====== MAIN CONTENT & PAGES ====== -->
  <main>
    <div id="page-catcher" class="page">
      <div class="container" id="catcher-container">
        <div class="classified-stamp">CLASSIFIED</div>
        <div id="intro-content">
          <h1 data-text="Unmask Your Digital Ghost">Unmask Your Digital Ghost</h1>
          <p class="tagline">Is your browser hiding in the shadows? Let's find out.</p>
          <div class="run-btn-wrapper">
            <button id="run-btn" onclick="runDetection()">Run Detection</button>
          </div>
        </div>
        <div id="results-container"></div>
      </div>
    </div>
    
    <div id="page-faq" class="page">
      <div class="container static-page">
        <h2 data-text="Frequently Asked Questions">Frequently Asked Questions</h2>
        <h3>What is this tool?</h3><p>SpectraScan analyzes your browser's fingerprint for signs of manipulation. Websites use these fingerprints to track you. Our tool checks for common spoofing techniques and flags connections from known VPNs or proxies.</p>
        <h3>Why is a high risk score bad?</h3><p>A high score suggests your fingerprint is inconsistent, a common trait of antidetect browsers. While used for privacy, these browsers are often flagged as fraudulent by platforms like banks and e-commerce sites.</p>
        <h3>Is this 100% accurate?</h3><p>No tool is infallible in the cat-and-mouse game of browser security. This tool provides a strong, indicative analysis, not absolute proof.</p>
      </div>
    </div>
    
    <div id="page-privacy" class="page">
        <div class="container static-page">
            <h2 data-text="Privacy Policy">Privacy Policy</h2>
            <p>Your privacy is paramount. Our policy is simple: we don't store your data.</p>
            <h3>IP Address Handling</h3><p>Your IP address is used *only* to perform the check with third-party databases during your session. It is never logged or stored on our servers.</p>
            <h3>Browser Fingerprint</h3><p>All fingerprinting happens in your browser. Raw data (WebGL, Canvas, etc.) is never sent to us. Your device performs the analysis locally.</p>
            <h3>Cookies & Tracking</h3><p>This website does not use cookies for tracking. Period.</p>
        </div>
    </div>
    
    <div id="page-contact" class="page">
        <div class="container static-page">
            <h2 data-text="Get In Touch">Get In Touch</h2>
            <p>Have a question or feedback? We'd love to hear from you. Fill out the form below and our team will get back to you as soon as possible.</p>
            <form class="contact-form" onsubmit="event.preventDefault(); alert('Thank you for your message! Our team will review it shortly.'); this.reset();">
                <div class="form-group"><input type="text" name="name" placeholder="Your Name" required></div>
                <div class="form-group"><input type="email" name="email" placeholder="Your Email Address" required></div>
                <div class="form-group"><input type="text" name="subject" placeholder="Subject" required></div>
                <div class="form-group"><textarea name="message" placeholder="Your Message" required></textarea></div>
                <button type="submit" class="form-submit-btn">Send Message</button>
            </form>
        </div>
    </div>
  </main>
  
  <footer>
    CLASSIFIED // FOR ANALYTICAL PURPOSES ONLY
    <div class="footer-icons">
      <i class="fa-solid fa-fingerprint"></i>
      <i class="fa-solid fa-bug"></i>
      <i class="fa-solid fa-user-secret"></i>
    </div>
  </footer>
</div>

<script>
  /* --- NAVIGATION, THEME, ROUTER --- */
  const hamburgerBtn = document.getElementById('hamburger-btn'); 
  const closeNavBtn = document.getElementById('close-nav-btn'); 
  const mainNav = document.getElementById('main-nav');
  hamburgerBtn.addEventListener('click', () => mainNav.classList.add('is-open'));
  closeNavBtn.addEventListener('click', () => mainNav.classList.remove('is-open'));
  
  const themeToggleBtn = document.getElementById('theme-toggle-btn'); 
  const body = document.body; 
  
  function applySavedTheme() { 
    const savedTheme = localStorage.getItem('theme'); 
    if (savedTheme === 'light') { 
      body.classList.add('light-mode'); 
    } else { 
      body.classList.remove('light-mode'); 
    } 
  }
  
  themeToggleBtn.addEventListener('click', () => { 
    body.classList.toggle('light-mode'); 
    localStorage.setItem('theme', body.classList.contains('light-mode') ? 'light' : 'dark');
  });
  
  const pageContent = { '/': 'page-catcher', '/faq': 'page-faq', '/privacy': 'page-privacy', '/contact': 'page-contact' };
  
  function showPageContent(pageId) {
    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    document.querySelectorAll('.nav-link').forEach(link => {
      link.classList.remove('active');
      const linkPath = link.getAttribute('href');
      const currentPath = window.location.pathname;
      if (linkPath === currentPath || (currentPath === '/' && linkPath === '/')) {
        link.classList.add('active');
      }
    });
  }

  const router = () => { 
    const path = window.location.pathname; 
    const pageId = pageContent[path] || 'page-catcher'; 
    showPageContent(pageId); 
  };
  
  document.addEventListener('click', (e) => { 
    const a = e.target.closest('a'); 
    if (a && (a.matches('.nav-link') || a.matches('.logo-link'))) { 
      e.preventDefault(); 
      history.pushState(null, '', a.href); 
      mainNav.classList.remove('is-open'); 
      router(); 
    }
  });
  
  window.addEventListener('popstate', router);
  
  document.addEventListener('DOMContentLoaded', () => { 
    applySavedTheme(); 
    router(); 
  });

  /* --- CATCHER SCRIPT --- */
  function resetCatcher() { 
      const intro = document.getElementById('intro-content');
      if (intro) intro.style.display = 'block';
      document.getElementById('results-container').innerHTML = ''; 
      setBackgroundState('default');
  }

  window.runDetection = async function() {
    const intro = document.getElementById('intro-content');
    if (intro) intro.style.display = 'none';

    const resultsEl = document.getElementById('results-container');
    resultsEl.innerHTML = `<div class="loader-wrapper"><div class="scanner-circle"></div><p class="scanner-text">ANALYZING SIGNATURE...</p></div>`;
    
    const detectionPromise = (async () => {
        let thumbmarkFingerprint = 'N/A';
        try {
            if (typeof ThumbmarkJS !== 'undefined') {
                thumbmarkFingerprint = await ThumbmarkJS.getFingerprint();
            } else { throw new Error("ThumbmarkJS library not found."); }
        } catch (err) {
            console.error("Could not get fingerprint:", err);
            thumbmarkFingerprint = '<span class="danger">Error generating fingerprint</span>';
        }

        const knownSpoofedCanvas = [-1222622419, -1982647924, -1687811050]; 
        const knownSpoofedAudio = [18028.99390631693, 48000.276471651436]; 
        const knownRealGPUs = ["NVIDIA GeForce RTX", "NVIDIA GeForce GTX", "AMD Radeon RX", "Apple M1", "Apple M2", "Apple M3"];
        
        let browserRiskScore = 0; 
        const gl = getWebGLInfo(); 
        const language = navigator.language; 
        const platform = navigator.platform; 
        const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone; 
        const canvasEntropy = getCanvasEntropy(); 
        const audioFingerprint = await getAudioFingerprint();
        
        if (!timezone.toLowerCase().includes(language.slice(0, 2))) browserRiskScore += 1;
        const isWinSpoofed = platform === "Win32" && gl.vendor.includes("Google Inc.") && gl.renderer.includes("ANGLE") && !knownRealGPUs.some(gpu => gl.renderer.includes(gpu));
        if (isWinSpoofed) browserRiskScore += 2; 
        if (knownSpoofedCanvas.includes(canvasEntropy)) browserRiskScore += 1; 
        if (audioFingerprint && knownSpoofedAudio.includes(audioFingerprint)) browserRiskScore += 1;
        
        let ipRisk = 0; 
        let ipData = null; 
        let ipError = false;
        try { 
            const resp = await fetch('/api/ip-check', { cache: 'no-store' }); 
            ipData = await resp.json(); 
            if (ipData.error) { ipError = true; } 
            else if (ipData.isProxy) { ipRisk = 2; }
        } catch (e) { ipError = true; }
        
        const totalRiskScore = browserRiskScore + ipRisk; 
        const isBadBrowser = totalRiskScore >= 3; 
        
        setBackgroundState(isBadBrowser ? 'danger' : 'safe');
        
        let resultsHTML = '';
        resultsHTML += `<div class="verdict-box ${isBadBrowser ? 'danger' : 'safe'}"><i class="fa-solid ${isBadBrowser ? 'fa-bomb' : 'fa-shield-check'} fa-lg"></i><span>${isBadBrowser ? "High Risk Profile Detected!" : "Profile Appears Normal"}</span></div>`;
        resultsHTML += `<div class="risk-score">Threat Score: <strong>${totalRiskScore}/5</strong></div>`;
        
        let detailsGridHTML = '';
        if (ipError) { 
            detailsGridHTML += `<div class="label">IP Status:</div><div class="value danger">Error</div>`;
        } else { 
            detailsGridHTML += `<div class="label">IP Address:</div><div class="value">${ipData.ip}</div>`;
            detailsGridHTML += `<div class="label">IP Status:</div><div class="value ${ipData.isProxy ? 'danger' : 'safe'}">${ipData.status}</div>`;
        }
        
        detailsGridHTML += `<div class="label">FP Hash:</div><div class="value fingerprint-hash">${thumbmarkFingerprint}</div>`;
        
        resultsHTML += `<div class="details-grid">${detailsGridHTML}</div>`;
        resultsHTML += `<div class="results-footer"><div class="results-separator ${isBadBrowser ? 'danger' : ''}"></div><div class="run-btn-wrapper"><button id="reset-btn" onclick="resetCatcher()">Run Another Test</button></div></div>`;
        
        return {html: resultsHTML, bad: isBadBrowser};
    })();
    
    const minDelay = new Promise(resolve => setTimeout(resolve, 2000));
    const [result] = await Promise.all([detectionPromise, minDelay]);
    
    resultsEl.innerHTML = result.html;
    
    const resetButton = document.getElementById('reset-btn');
    if (resetButton) {
        resetButton.classList.add(result.bad ? 'danger-button' : 'safe-button');
    }
  }
  
  function getCanvasEntropy() {try {const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');ctx.textBaseline="top";ctx.font="14px 'Arial'";ctx.fillText("BrowserFingerprinting",2,2);return hashString(canvas.toDataURL())}catch{return null}}
  function hashString(str){let hash=0;for(let i=0;i<str.length;i++){hash=((hash<<5)-hash)+str.charCodeAt(i);hash|=0}return hash}
  async function getAudioFingerprint(){try{const AudioContext=window.AudioContext||window.webkitAudioContext;if(!AudioContext)return null;const ctx=new AudioContext;const osc=ctx.createOscillator();const analyser=ctx.createAnalyser();const gain=ctx.createGain();const script=ctx.createScriptProcessor(4096,1,1);return new Promise(resolve=>{script.onaudioprocess=e=>{const output=e.outputBuffer.getChannelData(0);const hash=Math.abs(output.slice(4500,5000).reduce((a,b)=>a+b,0));resolve(parseFloat(hash.toFixed(12)));script.disconnect();osc.disconnect();gain.disconnect();analyser.disconnect();ctx.close()};osc.connect(analyser);analyser.connect(script);script.connect(gain);gain.connect(ctx.destination);osc.start(0)})}catch{return null}}
  function getWebGLInfo(){try{const canvas=document.createElement('canvas');const gl=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');const dbg=gl.getExtension('WEBGL_debug_renderer_info');return{vendor:gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL),renderer:gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL)}}catch{return{vendor:"unknown",renderer:"unknown"}}}

  /* --- MATRIX BACKGROUND SCRIPT --- */
  const canvas = document.getElementById('matrix-bg');
  const ctx = canvas.getContext('2d');
  let matrixInterval;

  const setupMatrix = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    setBackgroundState('default');
  };

  const drawMatrix = (color = 'rgba(0, 255, 136, 0.7)', speed = 40) => {
    const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    const charArray = characters.split('');
    const fontSize = 14;
    const columns = canvas.width / fontSize;
    const drops = Array(Math.floor(columns)).fill(1);
    return setInterval(() => {
        ctx.fillStyle = 'rgba(13, 13, 18, 0.05)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = color;
        ctx.font = fontSize + 'px Roboto Mono';
        for (let i = 0; i < drops.length; i++) {
            const text = charArray[Math.floor(Math.random() * charArray.length)];
            ctx.fillText(text, i * fontSize, drops[i] * fontSize);
            if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
            drops[i]++;
        }
    }, speed);
  }
  
  let gridOffset = 0;
  const drawBlueGrid = () => {
    return setInterval(() => {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = 'rgba(0, 170, 255, 0.15)';
        ctx.lineWidth = 1;
        gridOffset = (gridOffset + 0.5) % 80;
        for (let x = -gridOffset; x < canvas.width; x += 40) {
            ctx.beginPath();
            ctx.moveTo(x, 0);
            ctx.lineTo(x, canvas.height);
            ctx.stroke();
        }
        for (let y = -gridOffset; y < canvas.height; y += 40) {
            ctx.beginPath();
            ctx.moveTo(0, y);
            ctx.lineTo(canvas.width, y);
            ctx.stroke();
        }
    }, 50);
  }

  function setBackgroundState(state) {
      const watermark = document.getElementById('background-watermark');
      body.classList.remove('safe-mode', 'danger-mode');
      clearInterval(matrixInterval);
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      if (state === 'danger') {
          matrixInterval = drawMatrix('rgba(255, 71, 87, 0.7)', 25);
          watermark.dataset.text = 'ACCESS DENIED';
          body.classList.add('danger-mode');
      } else if (state === 'safe') {
          matrixInterval = drawBlueGrid();
          watermark.dataset.text = 'UNCLASSIFIED';
          body.classList.add('safe-mode');
      } else { // default
          matrixInterval = drawMatrix();
          watermark.dataset.text = '';
      }
  }

  window.addEventListener('resize', setupMatrix);
  document.addEventListener('DOMContentLoaded', setupMatrix);
</script>

</body>
</html>